(function(){var q,B;(function(){var b=this,e={};q=function(c,a){q[c]=a};B=function(c){if(B[c]===e)throw"Circular require";if(!q[c])throw"Unknown require: "+c;return B[c]||(B[c]=e)&&(B[c]=new function(){return q[c](this,B,b)||this})}})();q("adm-events",function(b,e){var c=e("util"),a=e("store"),i=e("routes"),h=b.COOKIE_SERVICE_TTL=30*a.MINUTES,d=b.EVENT_TTL=2*a.DAYS,f=b.prefix="e_",g=b.knownEventIds=[];b.addEventId=function(a){c.contains(g,a)||g.push(a)};var l=b.parse=function(a){a=a.split("&");return{id:a.shift(),
attrs:c.parseKeyValues(a.join("&"))}},j=b.stringify=function(a){return a.id+"&"+c.paramString(a.attrs)},m=b.storeEvent=function(c,b){b=b||0;a.set(f+j(c),1,d-b)},k=b.processEvent=function(a){var b="event_"+a.id;c.set(b,!0);c.eachHash(a.attrs,function(a,f){var d=b+"_attr_"+a,d=c.get(d)||c.set(d,[]);c.contains(d,f)||d.push(f)})},s=b.readFromStore=function(){var b=a.namespace(f);c.eachHash(b,function(a){k(l(a))})},n=b.process3rdParty=function(a){var b=/^e_(.*)/,f;c.eachHash(a,function(d){if(f=d.match(b)){var j=
l(f[1].replace(/\^/g,"&").replace(/\|/g,"="));c.contains(g,j.id)&&(d=(new Date-new Date(parseInt(a[d],10)))/1E3,m(j,d),k(j))}})};b.check3rdParty=function(){g.length&&!a.get("event3p")&&e("http").jsonp({url:c.get("url_cookies")||"//beacon.krxd.net/cookie2json",callback:"kxjsonp_3pevents",done:function(c){a.set("event3p","1",h);n(c)}})};s();i.simple("admEvent",function(a,b){var f={id:a,attrs:b};m(f);k(f);e("http").pixel({url:c.get("url_event"),data:c.extend({event_id:a,pub_id:c.get("pubid")},b)})})});
q("browser-sniff",function(b,e,c){var a=e("util"),i={ANDROID:"Android",CHROME:"Chrome",FIREFOX:"Firefox",IE:"Internet Explorer",OPERA:"Opera",OTHER:"Other",SAFARI:"Safari"},b=function(b){var b=b||a.deref(c,"navigator.userAgent"),d=a.partial(a.matchAll,b),b=d("Chrome","OPR"),f=d("Chrome")&&!b,g=d("Trident","WOW")||d("MSIE"),l=d("Linux","Android"),j=!b&&!f&&!g&&!l&&d("Safari","like Gecko"),d=d("Gecko","Firefox");return f?i.CHROME:g?i.IE:j?i.SAFARI:b?i.OPERA:d?i.FIREFOX:l?i.ANDROID:i.OTHER};return a.extend({Browsers:i,
is:b(),parse:b})});q("class",function(b,e){var c=e("util"),a=b.beget=function(a,b){function d(){this.constructor=b}c.extend(b,a);d.prototype=a.prototype;b.prototype=new d;return b};(b.Class=c.extend(function(){var a=arguments;c.each(this._class.initializers,function(c,b){b.apply(this,a)},this)},{extensions:{extension:[/^extension_(.+)/,function(a,b){var d={};d[a[1]]=b;this.extensions=c.extend(this.extensions||{},d)}]},mixin:function(a){c.isFunction(a)?a(this):c.each(a,c.bind(this.mixinProperty,this))},
mixinProperty:function(a,b){var d;c.some(this.extensions,function(c,g){if(d=a.match(g[0]))return g[1].call(this,d,b)||!0},this)||(this.prototype[a]=b)}})).mixin({_bind:function(a){c.each(a.split(" "),function(a){this[a]=c.bind(this[a],this)},this)},_apply:function(a,c){this[a].apply(this,c)},_super:function(a,b){var d,f=this._superctx;this._superctx=(this._superctx||this)._superproto;c.isString(a)?d=this._superctx[a].apply(this,b||[]):this._superctx.constructor.apply(this,a||[]);this._superctx=f;
return d},extension_classMethod:[/^__(.+)/,function(a,c){this[a[1]]=c}],extension_initialier:[/^_init_(.+)/,function(a,b){var d={};d[a[1]]=b;this.initializers=c.extend(this.initializers||{},d)}],__extend:function(b){a(this,b).construct(this,c.rest(arguments,1));return b},__construct:function(a,b){this.prototype._superproto=a.prototype;this.prototype._class=this;if(!this.name){var d=this.toString().match(/function\s+([^\(]+)/);d&&(this.name=d[1])}c.each(b,function(a){this.mixin(a)},this);this.init()},
__init:function(){}})});q("client-type",function(){return{PUBLISHER:0,MARKETER:1}});q("config",function(b,e){var c=e("util"),a=e("store"),i=e("stateful").Stateful,h=i.extend(function(a){this._super(arguments);this._type="Config";this._handles=[];this._persisted=[];this._defaults={confid:"no-confid"}},{get:function(a,b){var d=this._pointerPair(a),d=c.isString(d[1])?c.deref(d[0],d[1]):d[0];if(c.isString(d)){if(/^\d{1,12}$/.test(d))return Number(d);if(/^(true|false)$/.test(d))return"true"===d}return c.existy(d)?
d:b},set:function(a,b){var d=this._pointerPair(a),j;c.isString(d[1])?(j=c.deref(d[0],d[1]),d[0][d[1]]=b,this._fire("set",a,j,b)):this._super("set",arguments);return this},remove:function(a){var b=this._pointerPair(a),d;c.isString(b[1])?(d=c.deref(b[0],b[1]),delete b[0][b[1]],this._fire("remove",a,d,c.UNDEFINED)):this._super("remove",arguments);return this},has:function(a){return this._has(a)||c.existy(this.get(a))},persist:function(b){var b=c.difference(c.toArray(arguments),this._persisted),d=this,
l=function(b){d.has(b,!0)&&a.set(b,d.get(b))};this._handles.push.apply(this._handles,c.map(b,function(b){var d=c.partial(l,b);d();return c.compose(this.watch("set:"+b,d),this.watch("remove:"+b,function(){a.remove(b)},this))},this));this._persisted.push.apply(this._persisted,b)},destroy:function(){c.forEach(this._handles,function(a){a()});return this},toJSON:function(){return c.extend({},this._defaults,this._raw)},_has:function(){return i.prototype.has.apply(this,arguments)},_pointerPair:function(a){var b=
!1,d=a,j,e;0<a.indexOf(".")&&!this._has(a)&&(j=a.split("."),d=j[0],b=!0);a=i.prototype.get.call(this,d);b&&((b=j.slice(1,j.length-1).join("."))&&(a=c.deref(a,b)),e=j.pop());return[a,e]}}),d;return c.extend(function(a){if(a||!d)d=new h(a);return d},{Config:h},b)});q("context-terms",function(b,e,c){var a=e("util"),i=c.document,c="a form script noscript style select textarea button".split(" "),h=RegExp("<("+c.join("|")+")\\b","i"),d=RegExp("^("+c.join("|")+")$","i");b.process=function(b){for(var c=[i.body],
f="",e;e=c.shift();)3===e.nodeType?f+=e.nodeValue:1===e.nodeType&&!d.test(e.nodeName)&&(h.test(e.innerHTML)?[].unshift.apply(c,a.toArray(e.childNodes)):f+=e.innerText||e.textContent);f=f.replace(/\s\s+/g," ");a.each(b,function(b){b.matches=0;var c=RegExp("\\b"+a.escapeRegexp(b.value)+"\\b","ig");f.replace(c,function(){b.matches++})});b=a.filter(b,function(b){return a.set("context_term_"+b.id,b.matches)});a.set("context_terms_processed",!0);a.set("page_attr_kx_context_terms",b);a.set("context_terms",
a.map(b,function(a){return a.id}));return{text:f,terms:b}};var f=e("pixel"),b=b.pixelFormatter=function(b){return a.map(b,function(a){return a.id+f.tuppleSeparator+a.matches}).join(",")};f.addFormatter("_kpa_kx_context_terms",b)});q("crypto-util",function(b,e){var c=e("util"),a=function(a,b,c){return(a|b<<24-8*(c%4))>>>0},i=function(a){for(var b=[],c=0;c<a.length;c+=8)b.push(a.substr(c,8));return b};return b={BITS_PER_BYTE:8,BITS_PER_WORD:32,BYTES_PER_WORD:4,MAX_BYTE:255,MAX_WORD:4294967295,WORD_SIZE:32,
pad:function(a,b,c){for(var b=b||"0",g=[],c=(c||32)-a.length,l=0;l<c;++l)g.push(b);return g.join("")+a},fromWordToBytesArray:function(a){return c.map(c.range(4),function(b){return a>>>24-8*(b%4)&255})},fromBytesArrayToWord:function(b){return c.reduce(b,a,0)},toWord:function(a){return b.pad(Number(a).toString(2))},fromWord:function(a){return parseInt(a,2)},toHex:function(a){return Number(a).toString(16)},fromHex:function(a){return parseInt(a,16)},rotl:function(a,b,c){return a<<b|a>>>(c||32)-b},rotr:function(a,
b,c){return a>>>b|a<<(c||32)-b},fromWordsToLatin1:function(a){return c.map(a,function(a){return c.reduce(b.fromWordToBytesArray(a),function(a,b){return a+String.fromCharCode(b)},"")}).join("")},fromLatin1ToWords:function(a){for(var b=[],c=0,g=a.length;c<g;c++)b[c>>>2]|=(a.charCodeAt(c)&255)<<24-8*(c%4);return b},fromWordsToUtf8:function(a){try{return decodeURIComponent(escape(b.fromWordsToLatin1(a)))}catch(c){throw Error("Malformed UTF-8 data");}},fromUtf8ToWords:function(a){return b.fromLatin1ToWords(unescape(encodeURIComponent(a)))},
fromWordsToHex:function(a){for(var b=4*a.length,c=[],g=0;g<b;g++){var l=a[g>>>2]>>>24-8*(g%4)&255;c.push((l>>>4).toString(16));c.push((l&15).toString(16))}return c.join("")},fromHexToWords:function(a){return c.map(i(a),b.fromHex)},calculateSigBytesForWords:function(a){return c.sum(c.map(a,function(a){return c.filter(b.fromWordToBytesArray(a),c.identity).length}))}}});q("data-rewrite",function(b,e){var c=e("util"),a=e("expression"),i=c.rewriter({country:"user_attr_kx_geo_country",sub_section:"subsection",
segment:"user_segments"}),h=c.rewriter({"=":"is","!=":"isnt",before:"<",after:">"}),d=b.expression=function(b){var d=h(b.operator),l=i(b.name),j=b.delimiter;c.isArray(b.value)?b="["+b.value.join(",")+"]":(b=b.value,b=String(b),b=b.match(/,/)?"["+b.split(", ").join(",")+"]":b);var e=function(a,b,d){return c.map(a,function(a){return[b,"$"+d,a]})},k=c.isArray(a.get(l,j)),s=a.parse(b);if(c.isArray(s)){if("is"===d&&(d=k?"intersects":"memberOf"),"isnt"===d&&(d=k?"notIntersects":"notMemberOf"),"url"===l&&
!k){if("contains"===d)return["or"].concat(e(s,d,l));if("notContains"===d)return["and"].concat(e(s,d,l))}}else k&&("is"===d&&(d="contains"),"isnt"===d&&(d="notContains"));return[d,"$"+l+(j?":"+j:""),b]};b.tag=function(a){a=c.extend({},a,{criteria:["and"].concat(c.map(a.criteria,d))});a.freq_cap&&a.criteria.push(["<","$tag_deliveries_today",a.freq_cap]);a.user_percent&&a.criteria.push(["<",["random"],a.user_percent/100]);delete a.rules;/^\s*\/\/@eval\b/.test(a.content)&&(a.method="eval");a.name=a.name||
"Anonymous";a.timing=a.timing||"onload";return a};a.setDelimiter("user_segments",",");b.contextTermExpression=function(a){if("is"===h(a.operator))var b=a.occurrences.min||1,a=["or"].concat(c.map(a.values.split(","),function(a){return[">=","$context_term_"+a,b]}));else a=["and"].concat(c.map(a.values.split(","),function(a){return["is","$context_term_"+a,0]}));return["and","$context_terms_processed",a]}});q("data",function(b,e,c){var a=e("util"),i=b.root={},h=b.defs={};a.get=b.get=function(a){return i[a.match(/_/)?
a:"_"+a]};a.set=b.set=function(b,c){if(!a.isString(b))return a.each(b,a.set);b=b.match(/_/)?b:"_"+b;i[b]=c;a.fire("data:change",{key:b,value:c});return c};a.removeData=b.remove=function(a){delete i[a]};b.raw=function(){return i};var d=b.define=function(b,c){if(!a.isString(b))return a.each(b,d);h[b]=c},f=b.defaults=function(b,c){if(!a.isString(b))return a.each(b,f);var d=a.get(b);return null==d?a.set(b,c):d},g=b.namespace=function(b,c){var d=b+"_",g,e=RegExp(d+"(.+)"),f=a.attributes({get:function(b){return a.get(d+
b)},set:function(b,c){return a.set(d+b,c)},all:function(){var b={};a.eachHash(i,function(a,c){if(null!=(g=a.match(e)))b[g[1]]=c});return b},values:c}),h;f.change=function(b){h||(h=[],a.on("data:change",function(b){null!=(g=b.key.match(e))&&a.each(h,function(a){a(b)})}));h.push(b)};return f};b.user_attr=g("user_attr");b.page_attr=g("page_attr");e("routes").simple("set",a.set);e("routes").simple("get",a.get);e("routes").regexp(/data:(.+)/,function(a,b){return g(a[1],b)});e=c.navigator;if(e=e.language||
e.browserLanguage||e.userLanguage||e.systemLanguage)e=e.replace("_","-"),e=e.toLowerCase();b.user_attr("kx_lang",e);b.user_attr("kx_tech_browser_language",e)});q("dataprovider",function(b,e){var c=e("http"),a=e("util"),i=b.userMatch=function(b,e,g){c.pixel({url:a.get("url_um"),data:{partner:b,r:e,_kdpid:g}})},h=b.exelate=function(){i("exelate","//loadm.exelator.com/load/","e4942ff0-4070-4896-a7ef-e6a5a30ce9f9")};e("routes").simple("dataprovider.exelate",h)});q("dom-iframe",function(b,e,c){var a=e("util"),
i=function(b){this.options=a.extend({},h,b||{});this.node=e("dom").createElement("iframe",this.options.attr);this.insert();if(!this.options.attr.src||this.options.html)this.html(this.options.html||"")},h={target:null,targetAction:"append",html:"",attr:{}};i.prototype={insert:function(){var a=this.options,b=a.targetAction,a=a.target||c.document.body;e("dom").insert(b,a,this.node);this.win=i.window(this.node);this.doc=i.document(this.node)},html:function(a){var b=this.doc;a.match(/^<html>/)||(a="<html><head></head><body>"+
a+"</body></html>");b.open();b.write(a);b.close()}};i.window=function(a){return a.contentWindow};i.document=function(a){return i.window(a).document};b.IFrame=i});q("dom",function(b,e,c){function a(b,c,g){var e=b.tagName,f=b.attributes||{},b=b.children||[],c=c||[],g=g||0,v=j[e];c("<",e);d.each(f,function(a,b){c(" ",a,'="',b,'" ')});if(v)return c("/>");c(">");d.isString(b)?c(b):d.each(b,function(b){a(b,c,g+1)});v||c("</",e,">")}function i(b,c,g){b=d.isString(b)?{tagName:b,attributes:c,children:g}:b;
c=new s;a(b,c);return c.data()}function h(){try{l.documentElement.doScroll("left")}catch(a){f(h,1);return}d.fireOnce("dom:ready")}var d=e("util"),f=c.setTimeout,g=e("browser-sniff");d.extend(b,e("dom-iframe"));var l=c.document,j=new d.Set("area base basefont br col frame hr img input isindex link meta param embed".split(" ")),m=b.attr=function(a,b,c){var d;if(void 0===c)try{return a.getAttribute(b)||null!=(d=a.attributes[b])&&d.value||""}catch(g){return""}else{try{a.setAttribute(b,c)}catch(e){throw Error("Failed to set: "+
b);}return a}};b.removeAttr=function(a,b){try{a.removeAttribute(b)}catch(c){throw Error("Failed to remove: "+b);}};var k=b.text=function(a){return a.innerText||a.textContent};b.value=function(a){var b=a.nodeName;return"INPUT"===b?m(a,"value"):"TEXTAREA"===b&&k(a)};var s=b.StringStream=function(){function a(){b.push.apply(b,arguments);return a}var b=[];a.data=function(){return b.join("")};return a},n=b.createElement=function(){var a=i.apply(null,arguments),b=l.createElement("div");b.innerHTML=a;return b.childNodes[0]};
b.create=n;b.byId=function(a){return a&&a.nodeType?a:l.getElementById(a)};var u=b.head=function(a){a=a||l;return a.head||a.getElementsByTagName("head")[0]};b.document=function(a){return a.document||a.ownerDocument||a};b.window=function(a){a=b.document(a);return a.parentWindow||a.defaultView};var p=b.remove=function(a){a.parentNode.removeChild(a)};b.isNode=function(a){return!!a.nodeType};var r=b.before=function(a,b){a.parentNode.insertBefore(b,a)},t=b.append=function(a,b){a.appendChild(b)};b.after=
function(a,b){var c=a.nextSibling;c?r(c,b):t(a.parentNode,b)};b.prepend=function(a,b){var c=a.firstChild;c?r(c,b):t(a,b)};b.insert=function(a,c,d){if(3===arguments.length)b[a](c,d);else{var d=a,g=l.getElementsByTagName("script")[0];g.parentNode.insertBefore(d,g)}};b.replace=function(a,b){r(a,b);p(a)};b.scriptEval=function(a){var b=l.createElement("script");b.text=a;u(l).appendChild(b)};b.winEval=function(a,b){a.kxeval||(a.execScript?a.execScript("(function(){\n  var win = this;\n  win.kxeval = win.execScript ? \n    function(expr){return win.execScript(expr);} :\n    function(expr){return win.eval(expr);};\n})();"):
a.eval("(function(){\n  var win = this;\n  win.kxeval = win.execScript ? \n    function(expr){return win.execScript(expr);} :\n    function(expr){return win.eval(expr);};\n})();"));return a.kxeval(b)};b.childElements=function(a){var b=[];d.each(a.childNodes,function(a){1===a.nodeType&&b.push(a)});return b};b.onload=function(a,b){d.isFunction(b)&&(b={done:b});var c=d.once(b.done||d.doNothing),g=d.once(b.fail||d.doNothing),e=a.attachEvent?"attachEvent":"addEventListener",f=a.attachEvent?"on":"";d.each({load:c,
error:g,readystatechange:function(){a.readyState&&a.readyState.match(/complete|loaded/)&&c()}},function(b,c){a[e](f+b,c,!0)})};var o=1,v=b.hash=function(a){return a._krux_hash||(a._krux_hash=o++)},z={};b.meta=function(a){var b=v(a);return z[b]||(z[b]={node:a,hash:b})};n=c.navigator;b.ie=g.is===g.Browsers.IE;var w=b.ff=g.is===g.Browsers.FIREFOX;b.ua=n.userAgent.toLowerCase();var x=b.ua.match(/(webkit)[ \/]([\w.]+)/)||b.ua.match(/(opera)(?:.*version)?[ \/]([\w.]+)/)||b.ua.match(/(msie) ([\w.]+)/)||
0>b.ua.indexOf("compatible")&&b.ua.match(/(mozilla)(?:.*? rv:([\w.]+))?/)||["unknown","unknown",0];b.browser=x[1];b.version=parseFloat((x[2]||"0").match(/^[0-9]+[.0-9]*/)[0],10);b.msie=g.is===g.Browsers.IE;b.mozilla="mozilla"===x[1]&&!b.msie;b.webkit="webkit"===x[1];b.opera=g.is===g.Browsers.OPERA;b.gecko=-1!==b.ua.indexOf("gecko/");b.chrome=g.is===g.Browsers.CHROME;b.ie6=b.msie&&"6"===b.version;b.ie7=b.msie&&"7"===b.version;b.ie8=b.msie&&"8"===b.version;b.ie9=b.msie&&"9"===b.version;b.ie10=b.msie&&
"10"===b.version;b.ie11=b.msie&&"11"===b.version;b.browserBucket=b.msie?"IE."+b.version:w?"Firefox."+(4>b.version?"3x":"4plus"):b.opera?"Opera":b.chrome?"Chrome":b.webkit?"Webkit":"Other";b.lang=(n.language||n.systemLanguage||n.browserLanguage||n.userLanguage||"").substring(0,2);e("events");var y=!!c.window.attachEvent,E=b._on_=y?"attachEvent":"addEventListener",g=b.type={ready:{target:c.document},load:{target:c},unload:{target:c},beforeunload:{target:c}},D=b.on=function(a,b,c,d){b=(y?"on":"")+b;
a[E](b,c,d||!1)};b.d2on=c.addEventListener?function(a,b,c){a.addEventListener(b,c,!1);return{remove:function(){a.removeEventListener(b,c)}}}:function(a,b,c){a.attachEvent(b,c);return{remove:function(){a.detachEvent(b,c)}}};d.each(g,function(a,c){c.nativeName="ready"!==a?a:y?"readystatechanged":"DOMContentLoaded";b[a]=function(b){d.onOnce("dom:"+a,b)}});var A=function(a){return"load"!==a?function(){d.fireOnce("dom:"+a)}:function(){d.fireOnce("dom:ready");d.fireOnce("dom:load")}};b.createHead=function(a,
c){var g=e("sizzle"),f=d.first(g.find('div[data-id="'+a+'"]'));if(f)return f;b.kxhead=f=b.create("div",{"class":"kxhead","data-id":a,style:"display:none;"});c?b.before(c,f):b.insert(f);var j=b.insert;b.insert=function(a){1===arguments.length?b.append(f,a):j.apply(b,arguments)};return f};b.kruxDomain=function(a){var b=2,a=a.match(/^([^:]+)/)[1];if(!a.match(/(?:\d{1,3}\.){3}\d{1,3}/))return a=a.split(".").reverse(),a[1]&&a[1].match(/com?/)&&(b=3),a.slice(0,Math.min(b,a.length)).reverse().join(".")};
b.safeMode=function(){return-1<c.location.href.indexOf("krux_safe")||b.ie&&6>=b.version||b.gecko&&4>b.version||!c.document.readyState};if(/^(complete|loaded)$/.test(c.document.readyState))A("load")();else{if(b.ie){D(c,g.load.nativeName,A("ready"));n=!1;try{n=null==c.window.frameElement}catch(C){}l.documentElement.doScroll&&n&&h()}d.each(g,function(a,b){D(b.target,b.nativeName,A(a),!1)})}f(d.bind(d.fireOnce,null,"dom:load",{timedout:!0}),6E3)});q("events",function(b,e){var c=e("util"),a=e("class").Class,
a=b.Events=a.extend(function(){this._handlers={ALL:[]};this._happened={};this._super(arguments)},{on:function(a,b){if(c.isString(a))(this._handlers[a]||(this._handlers[a]=[])).push(b);else if(c.isFunction(a))this._handlers.ALL.push(a);else this.on(function(c){a.test(c.type)&&b(c)})},off:function(a,b){this._handlers[a]=b?c.remove(this._handlers[a],b):[]},fire:function(a,b){b=b||{};b.type||(b.type=a);this._happened[a]=b;"data:change"!==b.type&&c.log(b);var e=function(a){a(b)};c.each(this._handlers[a],
e);c.each(this._handlers.ALL,e);return b},onOnce:function(a,b){var e;return(e=this._happened[a])?c.defer(b,e):this.on(a,c.once(b))},fireOnce:function(a,b){return!this._happened[a]&&this.fire(a,b)},onOnceAll:function(a,b){var a=a.split(" "),b=c.once(b),e=c.bind(function(){c.all(a,function(a){return this._happened[a]},this)&&b()},this);c.each(a,function(a){this.onOnce(a,e)},this)},happened:function(a){return this._happened[a]},clear:function(a){this._happened=c.reduce(this._happened,function(b,c,e){a&&
0!==c.indexOf(a)&&(b[c]=e);return b},{})}}),i=b.instance=new a;i._bind("on off fire onOnce fireOnce onOnceAll happened");c.each("on off fire onOnce fireOnce onOnceAll happened".split(" "),function(a){c[a]=i[a]})});q("expression",function(b,e){var c=e("util"),a=c.isArray,i=c.isString,h={},d={},f,g=b.getDelimiter=function(a){return c.get(a+"DELIM")},l=b.setDelimiter=function(a,b){g(a)!==b&&c.set(a+"DELIM",b)},j=b.get=function(a,b){var d=c.get(a);b&&l(a,b);b=g(a);return c.isArray(d)?d:b?d?d.split(b):
[]:d},m=b.parse=function(a){var b;return c.isString(a)?(b=a.match(/^\$([^:]+)(?::(.*))?$/))?j(b[1],b[2]):(b=a.match(/^\[\s*((?:"|').*(?:"|'))\s*]$/))?c.map(b[1].replace(/("|')\s*,\s*\\?("|')/g,'"$DELIM$"').split("$DELIM$"),m):(b=a.match(/^\[\s*(.*)\s*]$/))?c.map(b[1].split(/\s*,\s*/),m):(b=a.match(/^"(.*)"$/))?b[1]:a:a},k=function(a){var b;b=(b=f(a[0]))&&(h[b]||d[b]);return b.apply(this,b.isMacro?c.rest(a):c.map(c.rest(a),f))};f=b.eval=function(b){return a(b)?k(b):i(b)?m(b):b};c.extend(h,{is:function(a,
b){return c.isString(a)?a.toLowerCase()===String(b).toLowerCase():a===b},matches:function(a,b){return RegExp(b).test(a)},startsWith:function(a,b){return h.matches(a,"^"+c.escapeRegexp(b))},endsWith:function(a,b){return h.matches(a,c.escapeRegexp(b)+"$")},contains:function(a,b){var a=a||[],d=(""+b).toLowerCase();return c.isArray(a)?c.any(a,function(a){return(""+a).toLowerCase()===d}):0<=(""+a).toLowerCase().indexOf(d)},memberOf:function(a,b){return h.contains(b,a)},intersection:function(a,b){return c.intersection(a,
b)},intersects:function(a,b){a=c.isArray(a)?a:[a];b=c.isArray(b)?b:[b];return c.any(a,function(a){return h.contains(b,a)})},random:function(){return Math.random()},now:function(){return new Date}});c.each(["<",">","<=",">="],function(a){h[a]=new Function("a","b","return a "+a+" b")});c.extend(h,{isnt:c.negate(h.is),notMemberOf:c.negate(h.memberOf),notContains:c.negate(h.contains),notIntersects:c.negate(h.intersects)});c.extend(d,{and:function(){return c.every(arguments,f)},or:function(){return c.any(arguments,
f)}});c.each(d,function(a,b){b.isMacro=!0})});q("feature",function(b,e){var c=e("browser-sniff");return{hasThirdPartyCookies:function(){return c.is!==c.Browsers.SAFARI}}});q("fingerprint-scraper",function(b,e){var c=e("util"),a=b.all=function(a,b){var b=b||c.yes,d=[],e=c.deref(a),m;for(m in e){var k=e[m];b(k,m,e)&&null!=k&&d.push(k)}return d};b.path=c.deref;var i=function(a){return function(b,d){return a(b,function(a,b){return c.contains(d,b)})}};b.keys=i(a);var h=b.pluckAll=function(a,b){var b=b||
c.yes,d=c.deref(a);return c.reduce(d.length?d:c.values(d),function(a,c){var d,e;for(e in c)c.hasOwnProperty(e)&&b(d=c[e],e,c)&&a.push(d);return a},[])},d=b.pluckKeys=i(h);b.pluckKeysWhere=function(a,b,e){return c.filter(d(a,b),e)};b.primitives=c.partial(a,c._,c.isPrimitive);b.serializable=c.partial(a,c._,c.isSerializable)});q("fingerprint",function(b,e,c){var a=e("util");e("data");e("dom");var i=e("fingerprint-scraper"),h=e("sha1"),e=a.partial(i.keys,"navigator"),d=a.partial(i.keys,"screen"),f=function(a){return a[0]*
a[1]},g=a.compose(d,f),l=a.partial(a.deref,c);b.canvas=function(){var a=document.createElement("canvas"),b=a.getContext("2d");b.textBaseline="top";b.font="14px 'Arial'";b.textBaseline="alphabetic";b.fillStyle="#f60";b.fillRect(125,1,62,20);b.fillStyle="#069";b.fillText("F1ng3r Print",2,15);b.fillStyle="rgba(102, 204, 0, 0.7)";b.fillText("F1ng3r Print",4,17);return[a.toDataURL()]};b.winSize=function(){return a.map([["innerHeight","innerWidth"],["outerHeight","outerWidth"]],function(b){return f(a.map(b,
l))})};b.mimeTypes=a.partial(i.pluckKeysWhere,"navigator.mimeTypes",["type","description","suffixes"],function(b){return""!==b&&a.isString(b)||a.isNumber(b)&&!a.isNaN(b)});b.navigatorPrimitives=a.partial(e,"onLine product appCodeName platform appVersion appName vendorSub vendor productSub cookieEnabled language".split(" "));b.plugins=a.partial(i.pluckKeys,"navigator.plugins",["name","filename","description"]);b.screenDepth=a.partial(d,["pixelDepth","colorDepth"]);b.screenResolution=a.partial(g,["availWidth",
"availHeight"]);b.screenSize=a.partial(g,["width","height"]);b.timezone=function(){return[(new Date).getTimezoneOffset()]};b.ua=function(){var a=i.path("navigator.userAgent");return[String(a).replace(/([a-z0-9]){8}\-(\1{4})\-\2\-\2\-\1{12}/i,"")]};var j=function(){return a.reduce(b,function(a,b,c){var d;try{d=c(),a.push.apply(a,d)}catch(e){}return a},[])};return a.extend(function(b){var c=b.get("fp"),d=b.get("fp_id"),e=h(j().sort().join(""));e!==c?(a.set("fp",e),b.set("fp",e),a.set("fp_id",d),a.set("fp_sent",
!0)):(a.set("fp_id",d),a.set("fp_sent",!1));a.onOnce("user_data_response",function(c){if(c.kfuid){a.set("fp_id",c.kfuid);b.set("fp_id",c.kfuid)}});return e},b,{raw:j})});q("flash",function(b,e){var c=function(a){try{return a.GetVariable("$version")}catch(b){}return""};b.version=function(){var a=e("util"),b="",h;if(navigator.plugins&&0<navigator.plugins.length){if(b=a.deref(navigator,"mimeTypes.application/x-shockwave-flash.enabledPlugin.description"))return a=b,h=a.split(/ +/),b=h[2].split(/\./),
h=h[3],{installed:!0,raw:a,major:parseInt(b[0],10),minor:parseInt(b[1],10),revision:parseInt(h.replace(/[a-zA-Z]/g,""),10)||h,revisionStr:h}}else if(-1===navigator.appVersion.indexOf("Mac")&&window.execScript){try{h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash.6"),b="6,0,21",h.AllowScriptAccess="always",b=c(h)}catch(d){}try{h=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),b=c(h)}catch(f){}if(b)return a=b,b=a.split(","),{installed:!0,raw:a,major:parseInt(b[0].split(" ")[1],10),minor:parseInt(b[1],
10),revision:parseInt(b[2],10),revisionStr:b[2]}}return{installed:!1,raw:"",major:"",minor:"",revision:"",revisionStr:""}}});q("geo",function(b,e){var c=e("util");e("json");var a=e("config"),i=e("privacy"),h=e("store");e("data");e("events");var d=function(a){c.forEach(a,function(b,c){var d=String(b).toLowerCase();d!==b&&(delete a[b],a[d]=c)});return a},f=function(a){h.impl&&h.set("geo",c.paramString(a),24*h.HOURS)};return b=c.extend(function(){var d=a();if(d.get("params.no_pii")||i.isOptOut())return c.forEach(b,
function(a,d){c.isFunction(d)&&(b[a]=c.doNothing)}),d.set("geo",{}),b;var l=d.get("geo");c.isString(l)&&d.set("geo",l=e("json").JSON.parse(l));c.isEmpty(l)?(c.on("user_data_response",function(a){a=(a||{}).geo||{};f(a);b.receive(a)}),d=h.impl?c.parseParams(h.get("geo")):{},c.isEmpty(d)||b.receive(d)):(b.receive(l),f(l));return b},{get:function(a){var b=c.get("geo")||{};return a?b[String(a).toLowerCase()]:b},set:function(a,e){1===arguments.length?c.set("geo",d(a)):c.get("geo")[String(a).toLowerCase()]=
e;return b},receive:function(a){b.set(a);c.forEach(["country","region","city","dma"],function(b){c.set("user_attr_kx_geo_"+b,a[b]||a[b.toUpperCase()])});c.fireOnce("geo:ready",b);return b}})});q("hash-set",function(b,e){function c(b,c){this._hash=function(c){var e=a.isFunction(b)?b(c):c;return String(void 0!==e?e:String(c))};this._q=[];this.put.apply(this,a.tail(arguments));this._items={}}var a=e("util");c.prototype._thunk=function(){var b=this._q,c=this._hash;a.forEach(b.splice(0,b.length),function(a){this._items[c(a)]=
a},this);return this};c.prototype.put=function(a){this._q.push.apply(this._q,arguments);return this};c.prototype.get=function(a){this._thunk();return this._items[this._hash(a)]};c.prototype.has=function(a){this._thunk();return this._hash(a)in this._items};c.prototype.remove=function(b){this._thunk();a.forEach(arguments,function(a){delete this._items[this._hash(a)]},this);return this};c.prototype.toArray=function(){this._thunk();return a.values(this._items)};c.prototype.fromArray=function(a){this.put.apply(this,
a);return this};c.prototype.toString=function(){this._thunk();return a.keys(this._items).join(",")};c.prototype.empty=function(){this._q=[];this._items={};return this};c.prototype.size=function(){this._thunk();return a.keys(this._items).length};return a.extend(function(b,e){var d=new c(b);d.put.apply(d,a.tail(arguments));return d},{HashSet:c})});(function(){function b(b,f){var b=b||"",f=f||{},j;for(j in e)e.hasOwnProperty(j)&&(f.autoFix&&(f["fix_"+j]=!0),f.fix=f.fix||f["fix_"+j]);var m={comment:/^<\!--/,
endTag:/^<\//,atomicTag:/^<\s*(script|style|noscript|iframe|textarea)[\s\/>]/i,startTag:/^</,chars:/^[^<]/},k={comment:function(){var a=b.indexOf("--\>");if(0<=a)return{content:b.substr(4,a),length:a+3}},endTag:function(){var c=b.match(a);if(c)return{tagName:c[1],length:c[0].length}},atomicTag:function(){var a=k.startTag();if(a){var c=b.slice(a.length);if(c.match(RegExp("</\\s*"+a.tagName+"\\s*>","i"))&&(c=c.match(RegExp("([\\s\\S]*?)</\\s*"+a.tagName+"\\s*>","i"))))return{tagName:a.tagName,attrs:a.attrs,
content:c[1],length:c[0].length+a.length}}},startTag:function(){var a=b.match(c);if(a){var d={};a[2].replace(i,function(a,b,c,e,f){a=c||e||f||h.test(b)&&b||null;d[b]="string"===typeof a?a.replace(/(&#\d{1,4};)/gm,function(a){a=a.substring(2,a.length-1);return String.fromCharCode(a)}):a});return{tagName:a[1],attrs:d,unary:!!a[3],length:a[0].length}}},chars:function(){var a=b.indexOf("<");return{length:0<=a?a:b.length}}},s=function(){for(var a in m)if(m[a].test(b)){d&&console.log("suspected "+a);var c=
k[a]();return c?(d&&console.log("parsed "+a,c),c.type=c.type||a,c.text=b.substr(0,c.length),b=b.slice(c.length),c):null}};if(f.fix){var n=/^(AREA|BASE|BASEFONT|BR|COL|FRAME|HR|IMG|INPUT|ISINDEX|LINK|META|PARAM|EMBED)$/i,u=/^(COLGROUP|DD|DT|LI|OPTIONS|P|TD|TFOOT|TH|THEAD|TR)$/i,p=[];p.last=function(){return this[this.length-1]};p.lastTagNameEq=function(a){var b=this.last();return b&&b.tagName&&b.tagName.toUpperCase()===a.toUpperCase()};p.containsTagName=function(a){for(var b=0,c;c=this[b];b++)if(c.tagName===
a)return!0;return!1};var r=function(a){a&&"startTag"===a.type&&(a.unary=n.test(a.tagName)||a.unary);return a},t=s,o=function(){b="</"+p.pop().tagName+">"+b},v={startTag:function(a){var c=a.tagName;"TR"===c.toUpperCase()&&p.lastTagNameEq("TABLE")?(b="<TBODY>"+b,z()):f.fix_selfClose&&u.test(c)&&p.containsTagName(c)?p.lastTagNameEq(c)?o():(b="</"+a.tagName+">"+b,z()):a.unary||p.push(a)},endTag:function(a){p.last()?f.fix_tagSoup&&!p.lastTagNameEq(a.tagName)?o():p.pop():f.fix_tagSoup&&(t(),z())}},z=function(){var a=
b,c=r(t());b=a;if(c&&v[c.type])v[c.type](c)},s=function(){z();return r(t())}}return{append:function(a){b+=a},readToken:s,readTokens:function(a){for(var b;(b=s())&&!(a[b.type]&&!1===a[b.type](b)););},clear:function(){var a=b;b="";return a},rest:function(){return b},stack:[]}}var e=function(){var a={},b=this.document.createElement("div");b.innerHTML="<P><I></P></I>";a.tagSoup="<P><I></P></I>"!==b.innerHTML;b.innerHTML="<P><i><P></P></i></P>";a.selfClose=2===b.childNodes.length;return a}(),c=/^<([\-A-Za-z0-9_]+)((?:\s+[\w\-]+(?:\s*=?\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)>/,
a=/^<\/([\-A-Za-z0-9_]+)[^>]*>/,i=/([\-A-Za-z0-9_]+)(?:\s*=\s*(?:(?:"((?:\\.|[^"])*)")|(?:'((?:\\.|[^'])*)')|([^>\s]+)))?/g,h=/^(checked|compact|declare|defer|disabled|ismap|multiple|nohref|noresize|noshade|nowrap|readonly|selected)$/i,d=!1;b.supports=e;b.tokenToString=function(a){var b={comment:function(a){return"<--"+a.content+"--\>"},endTag:function(a){return"</"+a.tagName+">"},atomicTag:function(a){console.log(a);return b.startTag(a)+a.content+b.endTag(a)},startTag:function(a){var b="<"+a.tagName,
c;for(c in a.attrs)var d=a.attrs[c],b=b+(" "+c+'="'+(d?d.replace(/(^|[^\\])"/g,'$1\\"'):"")+'"');return b+(a.unary?"/>":">")},chars:function(a){return a.text}};return b[a.type](a)};b.escapeAttributes=function(a){var b={},c;for(c in a){var d=a[c];b[c]=d&&d.replace(/(^|[^\\])"/g,'$1\\"')}return b};for(var f in e)b.browserHasFlaw=b.browserHasFlaw||!e[f]&&f;this.htmlParser=b})();q("http-jsonp",function(b,e,c){var a=e("class").Class,i=e("util"),h=e("ns"),d=c.document,f=h.self.inFlightKeys=h.self.inFlightKeys||
{},g=b.Request=a.extend(function(a){a.data=a.data||{};this.options=a;if(!a.callback)throw"Callback name is required";i.extend(this,a);this.self&&(this.done=i.bind(this.done,this.self),this.fail=i.bind(this.fail,this.self));this.plantReceiver();this.src=e("http").src(this);this._class.all.push(this)},{fail:function(a){i.fire("error",{message:"jsonp failed with status "+(a&&a.status||"unknown")+" src: "+this.src})},done:function(){},receive:function(a){this.time.end=new Date;return a.status?200==a.status?
this.done(a.body):this.fail(a):this.done(a)},plantReceiver:function(){var a=this.options.callback;this.data.callback=h.path+"."+a;f[a]=f[a]||0;f[a]++;h.self[a]=i.bind(function(){f[a]--;0===f[a]&&delete h.self[a];this.receive.apply(this,arguments)},this)},sendInline:function(){d.write('<script src="'+this.src+'" type="text/javascript"><\/script>');return this},send:function(){this.time={start:new Date};if(this.inline)return this.sendInline();var a=d.createElement("script");a.type="text/javascript";
a.src=this.src;var b=d.getElementsByTagName("script")[0];b.parentNode.insertBefore(a,b);return this},__all:[]});b.call=function(a){return(new g(a)).send()}});q("http",function(b,e,c){var a=e("util"),i=e("json").JSON,h=b.protocol="https:"===c.location.protocol?"https:":"http:",d=e("browser-sniff");e("dom");b.maxUrlLength=d.is===d.Browsers.IE?2048:8E3;var f=b.param=function(b,c){var d=a.isString(c)||a.isNumber(c)?c:i.stringify(c);return encodeURIComponent(b)+"="+encodeURIComponent(d)},g=b.src=function(c){function d(){return e+
"?"+g.join("&")}c.url=c.url||"no_url";var e=c.url;e.match(/^\/\//)&&(e=h+e);var g=a.map(c.data,f);if(!c.noClip)for(d().length>b.maxUrlLength&&a.fire("http:error",{code:"overflow",message:"URL over max length "+b.maxUrlLength+" length was "+d().length});d().length>b.maxUrlLength&&g.length;)g.pop();return d()};b.willClip=function(c){c=b.src(a.extend({noClip:!0},c));return c.length>b.maxUrlLength&&c.length-b.maxUrlLength};b.pixel=function(b){try{(new c.Image).src=g(b),a.fire("http:pixel",b)}catch(d){}};
b.jsonp=function(a){return e("http-jsonp").call(a)}});q("impression",function(b,e){var c=e("util"),a=e("pixel");e("data");var i=b.send=function(b){c.set("url_pixel",b.url);a.sendImpl(b)};b.init=function(a){i(a)}});q("index",function(b,e){e("init")});var F=window.postscribe;window.postscribe=null;q("init",function(b,e,c){var a=c.Krux||((c.Krux=function(){c.Krux.q.push(arguments)}).q=[]);if(!a.commit||a.ns)a.commit=a.commit||1,a.postscribe=c.postscribe,c.postscribe=F,c.Krux=function(b,h){var d;h.params=
h.params||{};d=h.params.control_tag_namespace;c.Krux=a;(d=e("ns").init(d,function(){return e("routes").call}))&&e("marketer"===h.params.client_type?"marketer":"publisher")(d,h)}});q("jslog",function(b,e,c){function a(a){f&&c.console&&c.console.log("Error:",a);i.happened("jslog.pixel")?a.msg!==l[l.length-1]&&!(l.length>10*Math.random())&&(l.push(a.msg),a.type+="-postload",g.push(a),d.pixel(n()),g=[]):g.push(a)}var i=e("util"),h=e("dom"),d=e("http"),f=-1<c.location.search.indexOf("kxdebug"),g=[],l=
[],j=b.errorTypes=["controltag","tag","test","http","js"],m=c.onerror||function(){return!1};c.onerror=function(b,d,e){try{if("string"!==typeof b)return m.apply(c,arguments);var f;var g=/https*:\/\/([^\/]+)\/([^?\/]+)/.exec(d);f=g&&"apiservices.krxd.net"===g[1]?"service:"+g[2]:g&&-1<g[1].indexOf("krxd.net")?"controltag":"";a({type:f||"js",url:d,line:e,msg:b});return m.apply(c,arguments)}catch(v){c.console&&c.console.log("Error in the error handler",v)}return m.apply(c,arguments)};var k=b.sortByPriority=
function(a){function b(a){a=i.indexOf(j,a.type);return-1!==a?a:j.length}return i.clone(a).sort(function(a,c){var d=b(a),e=b(c);return d<e?-1:d>e?1:0})};i.on("tag:fail",function(b){a({type:"tag",tagid:b.id,msg:b.error})});i.on("test:fail",function(b){a({type:"test",msg:b.code+":"+b.data})});var s,n=b.getPixelOptions=function(a){for(var a=a||{url:i.get("url_log"),data:{control_tag_version:c.Krux.version,commit:c.Krux.commit,pubid:i.get("pubid"),siteid:i.get("siteid"),site_name:i.get("site"),browser_bucket:h.browserBucket,
version_bucket:s,lang:h.lang,log_version:1.1,errors:k(g)}},b=a.data.errors;d.willClip(a)&&b.length;)b.pop();return a};i.on("test:all_done",function(){if(!(1>g.length)){var a=0;s=i.get("config_param_control_tag_version");a="alpha"===s?1:0.1;Math.random()>a||(d.pixel(n()),i.fire("jslog.pixel",{errors:g.length}),g=[])}});i.on("http:error",function(b){a({type:"http",msg:b.code+": "+b.message})})});q("json",function(b,e,c){var a=e("util"),i,h,d,f,g=function(a){return'"'+a.replace(/\\/g,"\\\\").replace(/"/g,
'\\"').replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/\t/g,"\\t")+'"'};f=function(b){++d;b=d<=i&&a.isNull(b)?"null":a.isUndefined(b)?"null":a.isBoolean(b)?!0===b?"true":!1===b?"false":""+b:a.isString(b)?g(b):a.isNumber(b)?""+b:a.isArray(b)?"["+a.map(b,f).join(",")+"]":a.isArguments(b)?"["+a.map(b,f).join(",")+"]":"{"+a.map(b,function(a,b){return(h?"\n"+Array(d+1).join("  "):"")+g(""+a)+":"+f(b)}).join(",")+(h?"\n"+Array(d+1).join("  "):"")+"}";--d;return b};b.myJSON={stringify:function(a,b){b=
b||{};h=b.pretty||!1;i=b.maxdepth||15;d=0;return f(a)}};b.JSON=c.JSON||b.myJSON});q("kxinterchange",function(b,e,c){var b=function(a){var b,a="kx"+a;try{b=this.localStorage}catch(d){}return(b?b[a]||"":(b=c.document.cookie)&&(b=b.match("\\b"+a+"=([^;]*)"))&&decodeURIComponent(b[1]))||""},a=e("util"),i=c.Krux,h=i.user,d=i.segments,f=b("user"),g=b("segs");e("test").module("kxinterchange-support-snippet",function(b){b.eq("Krux.user exported",h,f);b.eq("Krux.segments exported",d,g&&g.split(",")||[]);a.each(d,
function(a){b("Krux.dartKeyValues contains segment "+a,0<=i.dartKeyValues.indexOf("ksgmnt="+a))});f&&b("Krux.dartKeyValues contains user",0<=i.dartKeyValues.indexOf("u="+f))})});q("marketer",function(b,e,c){var a=e("util"),i=e("config"),h=e("dom");e("events");var d=e("fingerprint"),f=e("impression"),g=e("privacy"),l=e("routes"),j=e("sizzle"),m=e("store"),k=e("tag"),s=e("timing"),n=/^https?:\/\/([a-z0-9_\-\.]+\.)?krxd\.net(:\d{1,5})?(\/|$)/i,u=b.getParams=function(b){return a.urlParams(h.attr(b,"src"))},
p=b.next=function(b){var c=a.find(j.find("script[src*="+b+"]"),function(a){return!h.attr(a,"data-kx-id")&&n.test(a.src)});if(!c)throw Error("No node found for "+b);return c};return a.extend(function(b,j){var o=new Date,v=i(j),n=v.get("confid");h.createHead(n);var w=n+"-"+o.getTime();s.start();k.claimOneTimers(v.get("tags"));a.set("tags",v.get("tags")||[]);e("jslog");o=e("data");o.user_attr=o.namespace("user_attr");o.page_attr=o.namespace("page_attr");e("scrape");e("dataprovider");e("events");var x=
p(n);h.attr(x,"data-kx-id",w);w=u(x);if((x=v.get("services"))&&x.impression)w.url=x.impression;else throw Error("impression service not specified");a.set("confid",n);a.set("pubid",a.get("pubid")||v.get("publisher.uuid"));v.get("params.no_pii")&&(a.set("pixel_data__knopii",1),o.user_attr("kx_lang",null),o.user_attr("kx_tech_browser_language",null));e("test").init();e("test-visualtags").init();a.set("tags",v.get("tags"));a.set("config",v.toJSON());a.set("version_bucket",v.get("params.control_tag_version"));
a.set("max_segments",v.get("params.max_segments"));a.set("prioritized_segments",v.get("prioritized_segments"));o.namespace("config_param",v.get("params"));n=!/localStorage/.test(a.get("config_param_client_side_storage"));e("store").init(n);g();e("geo")();if(h.safeMode())a.onOnce("dom:load",a.bind(a.fireOnce,null,"report"));else{v.get("params.fingerprint")&&!g.isOptOut()&&d(m);n=a.map(a.get("tags"),e("data-rewrite").tag);a.set("tags",n);a.set("config_segments",v.get("realtime_segments"));a.onOnceAll("dom:load tag:all_done",
function(){a.fireOnce("report");v.get("params.remove_kxhead",true)&&setTimeout(function(){if(h.kxhead){h.remove(h.kxhead);h.kxhead=null}},250)});e("adm-events").check3rdParty();e("stats");e("social");l.api();if(v.has("context_terms"))a.onOnce("dom:load",function(){e("context-terms").process(v.get("context_terms"))});w._kpid=a.get("pubid");f.init(w);c.setTimeout(k.init,250)}s.end()},b)});q("ns",function(b,e,c){var a=e("util"),i=e("version"),h=c.Krux,d=b.NS_RE=/^ns:([\w\W]+)/,f=b.DEFAULT_NS="_default",
g=b.parseArgs=function(b){var c=b[0];(c=c.match(d))?(c=c[1],b=a.rest(b)):c=f;return{nsName:c,rest:b}},l;if(!(l=h.nsRouter)){var j=function(){var b=g(arguments),c=j.ns[b.nsName];if(!b.rest.length)return c;if(c)return c.apply(c,b.rest);j.q.push(arguments);return a.UNDEFINED};j.ns={};j.q=[];j.defineNamespace=function(b,c){var d=b||f;if(j.ns[d])return j.ns[d];var e=j.ns[d]=c(b);a.extend(e,{nsName:d,isDefault:d===f,path:"Krux.ns."+d});j.creator=j.creator||e;d=j.q.splice(0,j.q.length);a.each(d,function(a){j.apply(null,
a)});return e};j.nsRouter=j;a.extend(j,h);l=c.Krux=j}b.router=l;b.init=function(d,f){var g=b.self=b.router.defineNamespace(d,f);if(g){b.name=g.nsName;b.isDefault=g.isDefault;b.path=g.path;var j={version:i.version,commit:i.commit,require:e,define:q,_:a};a.extend(g,j);g.isDefault&&a.extend(c.Krux,j)}return g}});q("pixel",function(b,e,c){var a=e("util"),i=e("http"),h=e("config")(),d=e("dom"),f=e("data"),g=e("feature"),l=e("store"),j=c.Krux,m=b.sendImpl=function(b){var c={};a.eachHash(b,function(a,b){if(b=
u(a,b))c[a]=b});var b=a.get("config_param_control_tag_pixel_throttle"),d=100*Math.random();b&&b<d||i.pixel({url:a.get("url_pixel"),data:c})},k=b.stringifyValue=function(b){return null!=b&&(a.isArray(b)?a.map(b,k).join(p):b.toString())},s=b.formatters=[],n=b.addFormatter=function(a,b){s.push({test:a,formatter:b})},u=b.format=function(b,c){var d=a.find(s,function(c){return a.isString(c.test)?c.test===b:c.test.test(b)});return(d?d.formatter:k)(c)};b.tuppleSeparator=":";var p=b.arraySeparator=",",r=b.send=
function(b,c){var d=t(b,c);m(d);a.fireOnce("pixel",{phase:b,data:d})},t=b.gather=function(b,r){var o={source:"smarttag",fired:b,confid:a.get("confid"),_kpid:a.get("pubid"),_kcp_s:a.get("site"),_kcp_sc:a.get("section"),_kcp_ssc:a.get("subsection"),_kcp_d:a.get("domain"),_knifr:c.frames.length,_kpref_:c.document.referrer};!1===r&&(o.pageview=String(r));1!==a.get("pixel_data__knopii")&&(o.geo_country=a.get("user_attr_kx_geo_country"),o.geo_region=a.get("user_attr_kx_geo_region"),o.geo_city=a.get("user_attr_kx_geo_city"),
o.geo_dma=a.get("user_attr_kx_geo_dma"));a.size(a.get("config_segments"))&&(o.rtsegs=e("segments").realtime());var s=function(b,c){a.eachHash(c,function(a,c){o[b+a]=c})};s("_kua_",f.user_attr());s("_kpa_",f.page_attr());s("",f.namespace("pixel_data")());var k=c.performance,m=k&&k.navigation,i=k&&k.timing;m&&(i&&!(d.gecko&&9>d.version))&&(k=function(a,b){if(!b){b=a+"End";a=a+"Start"}var c=i[a]&&i[b]&&i[b]-i[a];return c==null||c<0||c>3E4?-1:c},a.extend(o,{t_navigation_type:m.type,t_dns:k("domainLookup"),
t_tcp:k("connect"),t_http_request:k("request"),t_http_response:k("response"),t_content_ready:k("navigationStart","domInteractive"),t_window_load:k("navigationStart","loadEventStart"),t_redirect:k("redirect")}));var m=e("scrape"),k=a.happened("user_data_response"),A=e("ns"),A=A.isDefault?j:j[A.name]||{};a.extend(o,{interchange_ran:A.hasOwnProperty("user"),store_user:A.user,store_segs:A.segments,dart_user:m.dart("u"),dart_segs:m.dart("ksgmnt")||m.dart("ksg"),userdata_was_requested:!!a.happened("user_data_request"),
userdata_did_respond:!!k,store_user_after:l.get("user"),store_segs_after:l.get("segs")});k&&a.extend(o,{userdata_user:[k.kuid,k.kuid_long],userdata_segs:k.segments});m=l.get("org_user_id");a.existy(m)?a.extend(o,{_kuid:m}):h.get("params.fingerprint")&&!g.hasThirdPartyCookies()&&a.extend(o,{_kuid:a.get("kfuid")});a.each({user:"_kua_",page:"_kpa_"},function(b,c){a.each(f[b+"_attr"](),function(a,b){o[c+a]=b})});var C;try{C=c.sessionStorage}catch(t){}if(C)try{o.sview=C.krux_views=+(C.krux_views||0)+1}catch(p){}C=
a.get("tags");C=a.filter(C,function(a){return a.time&&a.time.end});a.each(C,function(a,b){o["kplt"+b]=a.id;s("tag"+a.id+"_timing",{duration:a.time.duration})});n(/tag.*_timing/i,function(){return false});o.jsonp_requests=a.map(e("http-jsonp").Request.all,function(a){return[a.url,a.time.end-a.time.start]});return o},o=b.sendOnce=a.once(r);b.init=function(){a.onOnce("report",function(){var b=a.bind(o,null,"report");a.happened("user_data_fetch_scheduled")?(a.onOnce("user_data_response",function(){a.defer(b)}),
c.setTimeout(function(){o("user_data_timeout")},300)):b()});a.onOnce("dom:beforeunload",function(){o("dom:beforeunload")});a.onOnce("dom:unload",function(){o("dom:unload")});a.on("navigation",function(b){b={source:"smarttag",type:"navigation",_kpid:a.get("pubid"),_kcp_s:a.get("site"),_kcp_sc:b.section,_kcp_ssc:b.subsection};m(b)});e("test").module("pixel",function(b){b("pixel",a.happened("pixel"))})}});(function(){function b(){}function e(a){return a!==g&&null!==a}function c(a,b,c){var d,e=a&&a.length||
0;for(d=0;d<e;d++)b.call(c,a[d],d)}function a(a,b,c){for(var d in a)a.hasOwnProperty(d)&&b.call(c,d,a[d])}function i(b,c){a(c,function(a,c){b[a]=c});return b}function h(a){try{return l.call(a)}catch(b){var d=[];c(a,function(a){d.push(a)});return d}}var d={afterAsync:b,afterDequeue:b,afterStreamStart:b,afterWrite:b,beforeEnqueue:b,beforeWrite:function(a){return a},done:b,error:function(a){throw a;},releaseAsync:!1},f=this,g=void 0;if(!f.postscribe){var l=Array.prototype.slice,j=function(a,b,c){var d=
k+b;if(2===arguments.length)return d=a.getAttribute(d),!e(d)?d:String(d);e(c)&&""!==c?a.setAttribute(d,c):a.removeAttribute(d)},m=function(a,b){var c=a.ownerDocument;i(this,{root:a,options:b,win:c.defaultView||c.parentWindow,doc:c,parser:htmlParser("",{autoFix:!0}),actuals:[a],proxyHistory:"",proxyRoot:c.createElement(a.nodeName),scriptStack:[],writeQueue:[]});j(this.proxyRoot,"proxyof",0)},k="data-ps-";m.prototype.write=function(){[].push.apply(this.writeQueue,arguments);for(var a;!this.deferredRemote&&
this.writeQueue.length;)a=this.writeQueue.shift(),"function"===typeof a?this.callFunction(a):this.writeImpl(a)};m.prototype.callFunction=function(a){var b={type:"function",value:a.name||a.toString()};this.onScriptStart(b);a.call(this.win,this.doc);this.onScriptDone(b)};m.prototype.writeImpl=function(a){this.parser.append(a);for(var b,a=[],c,d;(b=this.parser.readToken())&&!(c=!b||!("tagName"in b)?!1:!!~b.tagName.toLowerCase().indexOf("script"))&&!(d=!b||!("tagName"in b)?!1:!!~b.tagName.toLowerCase().indexOf("style"));)a.push(b);
this.writeStaticTokens(a);c&&this.handleScriptToken(b);d&&this.handleStyleToken(b)};m.prototype.writeStaticTokens=function(a){a=this.buildChunk(a);if(a.actual)return a.html=this.proxyHistory+a.actual,this.proxyHistory+=a.proxy,this.proxyRoot.innerHTML=a.html,this.walkChunk(),a};m.prototype.buildChunk=function(a){var b=this.actuals.length,d=[],e=[],f=[];c(a,function(a){d.push(a.text);if(a.attrs){if(!/^noscript$/i.test(a.tagName)){var c=b++;e.push(a.text.replace(/(\/?>)/," "+k+"id="+c+" $1"));"ps-script"!==
a.attrs.id&&"ps-style"!==a.attrs.id&&f.push("atomicTag"===a.type?"":"<"+a.tagName+" "+k+"proxyof="+c+(a.unary?" />":">"))}}else e.push(a.text),f.push("endTag"===a.type?a.text:"")});return{tokens:a,raw:d.join(""),actual:e.join(""),proxy:f.join("")}};m.prototype.walkChunk=function(){for(var a,b=[this.proxyRoot];e(a=b.shift());){var c=1===a.nodeType;if(!c||!j(a,"proxyof"))c&&(this.actuals[j(a,"id")]=a,j(a,"id",null)),(c=a.parentNode&&j(a.parentNode,"proxyof"))&&this.actuals[c].appendChild(a);b.unshift.apply(b,
h(a.childNodes))}};m.prototype.handleScriptToken=function(a){var b=this.parser.clear();b&&this.writeQueue.unshift(b);a.src=a.attrs.src||a.attrs.SRC;if(a.src&&this.scriptStack.length)this.deferredRemote=a;else this.onScriptStart(a);var c=this;this.writeScriptToken(a,function(){c.onScriptDone(a)})};m.prototype.handleStyleToken=function(a){var b=this.parser.clear();b&&this.writeQueue.unshift(b);a.type=a.attrs.type||a.attrs.TYPE||"text/css";this.writeStyleToken(a);b&&this.write()};m.prototype.writeStyleToken=
function(a){var b=this.buildStyle(a);this.insertStyle(b);a.content&&(b.styleSheet&&!b.sheet?b.styleSheet.cssText=a.content:b.appendChild(this.doc.createTextNode(a.content)))};m.prototype.buildStyle=function(b){var c=this.doc.createElement(b.tagName);c.setAttribute("type",b.type);a(b.attrs,function(a,b){c.setAttribute(a,b)});return c};m.prototype.insertStyle=function(a){this.writeImpl('<span id="ps-style"/>');var b=this.doc.getElementById("ps-style");b.parentNode.replaceChild(a,b)};m.prototype.onScriptStart=
function(a){a.outerWrites=this.writeQueue;this.writeQueue=[];this.scriptStack.unshift(a)};m.prototype.onScriptDone=function(a){a!==this.scriptStack[0]?this.options.error({message:"Bad script nesting or script finished twice"}):(this.scriptStack.shift(),this.write.apply(this,a.outerWrites),!this.scriptStack.length&&this.deferredRemote&&(this.onScriptStart(this.deferredRemote),this.deferredRemote=null))};m.prototype.writeScriptToken=function(a,b){var c=this.buildScript(a),d=this.shouldRelease(c),e=
this.options.afterAsync;a.src&&(c.src=a.src,this.scriptLoadHandler(c,!d?function(){b();e()}:e));try{this.insertScript(c),(!a.src||d)&&b()}catch(f){this.options.error(f),b()}};m.prototype.buildScript=function(b){var c=this.doc.createElement(b.tagName);a(b.attrs,function(a,b){c.setAttribute(a,b)});b.content&&(c.text=b.content);return c};m.prototype.insertScript=function(a){this.writeImpl('<span id="ps-script"/>');var b=this.doc.getElementById("ps-script");b.parentNode.replaceChild(a,b)};m.prototype.scriptLoadHandler=
function(a,b){function c(){a=a.onload=a.onreadystatechange=a.onerror=null}var d=this.options.error;i(a,{onload:function(){c();b()},onreadystatechange:function(){/^(loaded|complete)$/.test(a.readyState)&&(c(),b())},onerror:function(){var e={message:"remote script failed "+a.src};c();d(e);b()}})};m.prototype.shouldRelease=function(a){return!/^script$/i.test(a.nodeName)||!(!this.options.releaseAsync||!a.src||!a.hasAttribute("async"))};var s,n=function(){var a=t.shift(),b;a&&(b=a[a.length-1],b.afterDequeue(),
a.stream=u.apply(null,a),b.afterStreamStart())},u=function(a,c,d){function e(a){a=d.beforeWrite(a);o.write(a);d.afterWrite(a)}o=new m(a,d);o.id=r++;o.name=d.name||o.id;p.streams[o.name]=o;var f=a.ownerDocument,g={close:f.close,open:f.open,write:f.write,writeln:f.writeln};i(f,{close:b,open:b,write:function(){return e(h(arguments).join(""))},writeln:function(){return e(h(arguments).join("")+"\n")}});var j=o.win.onerror||b;o.win.onerror=function(a,b,c){d.error({msg:a+" - "+b+":"+c});j.apply(o.win,arguments)};
o.write(c,function(){i(f,g);o.win.onerror=j;d.done();o=null;n()});return o},p=function(c,g,r){"function"===typeof r&&(r={done:r});var j=r,j=j||{};a(d,function(a,b){e(j[a])||(j[a]=b)});var r=j,c=/^#/.test(c)?f.document.getElementById(c.substr(1)):c.jquery?c[0]:c,k=[c,g,r];c.postscribe={cancel:function(){k.stream?k.stream.abort():k[1]=b}};r.beforeEnqueue(k);t.push(k);o||n();return c.postscribe},r=0,t=[],o=null;s=i(p,{streams:{},queue:t,WriteStream:m});f.postscribe=s}})();q("privacy",function(b,e){var c=
e("util");e("events");var a=e("feature"),i=e("http"),h=e("routes"),d=e("store"),f=e("config");e("events");e("data");var g={ATTEMPT_CHANGE:"optout_attempt_change",CHANGE:"optout_change",ERROR:"optout_error",REQUEST:"optout_request",RESPONSE:"optout_response"},l=b.OPTOUT_ALLOWED_KEYS=[/^tag\d*\.day$/,"optout"];b.Events=c.clone(g);var j=function(a){return c.extend({code:"success",type:"no_change",time:new Date},a)},m=!1,k=b.fetch=function(a){c.fire(g.REQUEST);i.jsonp({callback:"kxjsonp_optOutCheck",
done:a,fail:c.partial(c.fire,g.ERROR),url:f().get("services.is_optout")})},s=function(b){c.fire(g.ATTEMPT_CHANGE);var d=c.partial(c.fire,g.CHANGE);a.hasThirdPartyCookies()?i.jsonp({callback:"kxjsonp_optOutChange",done:d,fail:c.partial(c.fire,g.ERROR),url:f().get("services.set_opt"+(b?"out":"in"))}):d(j({type:"optout_change"}))},n=b.optOut=function(a){(a=c.existy(a)?a:!0)?(u()||s(a),d.allowOnly.apply(d,l),d.clear(),d.set("optout","true")):(u()&&s(a),d.allowAll(),d.remove("optout"));m=a;f().set("dnt",
m)},u=b.isOptOut=function(){return!(!m&&!f().get("dnt")&&!(c.isFunction(d.get)&&"true"===d.get("optout")||/^(?:yes|1)$/.test(c.G.navigator.doNotTrack)))};b.handler=function(a){c.fire(g.RESPONSE,a);a.optout||/^(?:OPTOUT|DNT)$/i.test(a._kuid_||"")?n():(!a||c.existy(a.optout)||c.existy(a._kuid_))&&n(!1)};return c.extend(function(){k(b.handler);var a=function(){u()&&n();c.off(d.READY_EVENT,a)};c.on(d.READY_EVENT,a);h.simple("optout",function(a,b){b=c.isFunction(b)?b:c.noop;if(c.existy(a)){if(a===u()){b(null,
j());return}}else return u();var d=function(){c.off(g.CHANGE,e);c.off(g.ERROR,f)},e=function(a){b(null,a);d()},f=function(a){b(Error(a.message),a);d()};c.on(g.CHANGE,e);c.on(g.ERROR,f);n(a)})},b)});q("publisher",function(b,e,c){var a=c.location,i=e("config"),h=c.document;e("dom");var d=e("feature"),f=e("fingerprint"),g=e("privacy"),l=e("store"),j=e("util"),m=e("timing");return function(b,s){m.start();var n=i(s),u=e("dom");e("jslog");var p=e("data");p.user_attr=p.namespace("user_attr");p.page_attr=
p.namespace("page_attr");var r=e("routes");e("scrape");e("dataprovider");e("events");h.getElementById("kxinterchange")&&e("kxinterchange");var t=n.get("confid");u.createHead(t);j.set("confid",t);j.set("pubid",j.get("pubid")||n.get("publisher.uuid"));j.set("domain",u.kruxDomain(a.host));j.set("site",j.get("site")||n.get("site.name")||j.get("domain"));j.set("siteid",j.get("siteid")||n.get("site.id"));n.get("params.no_pii")&&(j.set("pixel_data__knopii",1),p.user_attr("kx_lang",null),p.user_attr("kx_tech_browser_language",
null));e("pixel").init();e("test").init();e("test-visualtags").init();j.set("tags",n.get("tags"));j.set("url",c.location.href);j.set("config",n.toJSON());j.set("version_bucket",n.get("params.control_tag_version"));j.set("max_segments",n.get("params.max_segments"));j.set("prioritized_segments",n.get("prioritized_segments"));p.namespace("url",n.get("services"));p.namespace("config_param",n.get("params"));p=!/localStorage/.test(j.get("config_param_client_side_storage"));p=l.init(p);g();e("geo")();if(u.safeMode())c.console&&
c.console.log("Krux running in safe mode, no tags will be delivered"),j.onOnce("dom:load",j.bind(j.fireOnce,null,"report"));else{n.get("params.fingerprint")&&!g.isOptOut()&&f(l);var t=n.get("params.user_id_cookie"),o=l.cookie.get(t);j.existy(t)&&o&&!d.hasThirdPartyCookies()?(p.set("org_user_id",o),j.set("user",o)):p.remove("org_user_id");p=j.map(j.get("tags"),e("data-rewrite").tag);j.set("tags",p);j.set("config_segments",n.get("realtime_segments"));j.onOnceAll("dom:load tag:all_done",function(){j.fireOnce("report");
n.get("params.remove_kxhead",true)&&setTimeout(function(){if(u.kxhead){u.remove(u.kxhead);u.kxhead=null}},250)});e("adm-events").check3rdParty();e("stats");e("social");r.api();if(n.get("context_terms"))j.onOnce("dom:load",function(){e("context-terms").process(n.get("context_terms"))});e("tag").init();n.get("params.recommend")&&e("recommend")}m.end()}});q("recommend",function(b,e,c){var a=e("util"),i=e("dom"),h=e("flash").version(),d=c.document;e("data");var f=e("geo");e("routes").simple("recommend",
function(b,l){var l=l||{},j=i.byId(b);if(!j)throw Error('Could not find target element with id "'+b+'"');var m=l.stylesheet;if(m&&!i.byId(b+"_style")){var k=d.createElement("link");k.id=b+"_style";k.rel="stylesheet";k.type="text/css";k.href=m;i.append(i.head(d),k)}m={pubid:a.get("pubid"),test:l.test||0,site_id:a.get("siteid"),url:c.document.location.href||"",ref:c.document.referrer||"",cat:l.cat||"",search:l.search||"",utc:(new Date).getTimezoneOffset(),lang:c.navigator.language,fv:[h.major,h.minor].join("."),
h:c.screen.height,w:c.screen.width,co:f.get("country")||"",st:f.get("region")||"",met:f.get("dma")||"",pcode:f.get("zip")||"",kuid:a.get("user")||"",seg:(a.get("user_segments")||[]).join(","),allimps:1};k=l.links||5;m.nm=(l.fields||[0,1,2,3]).join(",");m.nv="1.0";m.ni=k;e("http").jsonp({url:a.get("url_recommendation"),callback:"kxjsonp_recommendation",data:m,done:function(a){var b,c=i.byId(l.template);c&&(b=i.text(c));b=e("template").compile(b||'<ul>{{#entry}}<li><a href="{{actionlink}}">{{title}}</a> - {{description}}</li>{{/entry}}</ul>');
j.innerHTML=b.render(a)}})})});q("routes",function(b,e,c){var a=e("util"),i=e("ns"),h=b.routes=[],d=b.q=c.Krux&&c.Krux.q||[],f=b.getHandler=function(b){return a.find(h,function(a){return a[0].test(b)})},g=b.call=function(b){var c=arguments,g;if(i.NS_RE.test(b))return g=i.router(b),1<a.size(c)?g.apply(g,a.tail(c)):g;if(a.isFunction(b))return b.call(null,e);if(g=f(b))return g[1].apply(null,c);d.push(a.toArray(c));return a.UNDEFINED},l=b.understands=function(a){return!!f(a)},j=b.replay=function(){var b=
a.clone(d);d.length=0;a.each(b,function(a){g.apply(null,a)})},m=b.add=function(a,b){h.push([a,b]);j()},k=b.regexp=function(b,c){m(b,function(d){return c.apply(this,[d.match(b)].concat(a.rest(arguments)))})},s=b.simple=function(b,c){k(RegExp("^"+b+"$"),function(){return c.apply(null,a.rest(arguments))})};b.once=function(c,d){var e=function(){h=b.routes=a.remove(h,e);return d.apply(this,arguments)};s(c,e)};b.namespace=function(b,c){k(RegExp("^"+b+"\\.(.*)"),function(b){c[b[1]].apply(c,a.rest(arguments))})};
b.api=function(){k(/^fire:(.+)/,function(b,c){return a.fire(b[1],c)});k(/^on:(.+)/,function(b,c){return a.on(b[1],c)});k(/^fireOnce:(.+)/,function(b,c){return a.fireOnce(b[1],c)});k(/^onOnce:(.+)/,function(b,c){return a.onOnce(b[1],c)});k(/^require:?(.*)/,function(a,b){return a[1]?e(a[1]):b?e(b):e});s("define",q);s("JSON.stringify",e("json").JSON.stringify);s("log",a.log);s("page:load",function(b,d){var f=e("pixel");try{a.set("url",String(c.location)),g("tag:reload",function(a){b&&b(a);f.send("ajax",
d&&d.pageView)})}catch(r){b(r)}})};s("understands",l)});q("scrape",function(b,e,c){var a=e("util"),i=e("data"),h=e("sizzle"),d=e("routes"),f=e("dom"),g=b.defaultExcludes="sz dcopt ord tile pos uri click ksgmnt null undefined".split(" "),l=b._dart=function(){function d(a){return h.find("script[src*="+e+"]",a).concat(h.find("iframe[src*="+e+"]",a))}var e=".doubleclick.net",f={},g=[],g=g.concat(d(c.document)),r=h.find("iframe[src*=://"+c.location.hostname+"]").concat(h.find("iframe[src^=/]"));a.each(r,
function(a){try{g=g.concat(d(a.contentWindow.document))}catch(b){}});b.dartElements=g;a.each(g,function(b){var c,b=(c=h.attr(b,"src").match(/[^;]*;(.*)/))&&c[1];c=a.parseKeyValues(b,";");a.eachHash(c,function(b,c){var d=f[b];d&&d!==c?(a.isArray(d)||(d=[d]),a.isArray(c)?d=d.concat(c):d.push(c),f[b]=a.uniq(d)):f[b]=c})});if(g[0]){var j,r=(j=h.attr(g[0],"src").match(/\.doubleclick\.net(\/[^;]*)/))?j[1]:"";i.page_attr({dfpsite:r.split("/")[2],dfpzone:r.split("/")[3]})}return f},j,m=b.extensions={},e=
b.extension=function(a,c){m[a]=b[a]=c;d.simple("scrape."+a,c);return c};a.eachHash({dart:function(b){if(!j||a.isEmpty(j))j=l();var c=new a.Set(b&&b._excludes||g);return null==b?j:a.isString(b)?j[b]:a.eachHash(b,function(b,d){var e=i.namespace(b);a.isArray(d)?a.each(d,function(a){j[a]&&e(a,j[a])}):"*"===d?a.eachHash(j,function(a,b){c[a]||e(a,b)}):a.set(b,j[d])})},dom:function(a){var b=a.match(/^(.+):([^:]+)$/),a=h.find(b[1])[0],b=b[2];return a&&b&&("text"===b?f.text(a):"value"===b?f.value(a):"@"===
b.charAt(0)&&f.attr(a,b.substr(1)))},link_rel:function(a){return b.dom("link[rel="+a+"]:@href")},link_rev:function(a){return b.dom("link[rev="+a+"]:@href")},meta_name:function(a){return b.dom("meta[name="+a+"]:@content")},meta_property:function(a){return b.dom("meta[property="+a+"]:@content")},opengraph:function(a){return b.meta_property("og:"+a)},url_path:function(a){return b.location.pathname.split("/")[a]},url_param:function(a){var c;return(c=b.location.href.match("\\b"+a+"(?:=|\\b)([^&]*)"))&&
(decodeURIComponent(c[1])||!0)},url_hash:function(a){return[""].concat(String(c.location.hash).replace(/^(?:#|\/){0,}/,"").split("/"))[a]},url_host:function(a){return b.location.hostname.split(".").reverse()[a-1]},url_domain:function(c){return a.last(b.location.hostname.split("."),c).join(".")},cookie:function(a){var b;return(b=c.document.cookie)&&(b=b.match("\\b"+a+"=([^;]*)"))&&decodeURIComponent(b[1])},data:function(b){return a.get(b)},javascript:function(b){try{return c.eval(b)}catch(d){a.fire("error",
d)}},js_global:function(a){try{for(var b=c,d=a.split(".");b&&d[0];)b=b[d.shift()];return b}catch(e){}}},e);b.location=c.location;var k=b.scrape=function(b){var c={};a.eachHash(b,function(d,e){var f=a.findHash(e,function(a){return m[a]&&a});if(!f)return a.fire("error",{message:"No extension found",scrape:b});f=m[f](e[f]);c[d]=f});return c};d.simple("scrape",function(b){b=k(b);a.set(b);return b})});q("segments",function(b,e){var c=e("util"),a=e("config")(),i=e("data"),h=e("privacy"),d=e("store"),f=
c.param("segs");f&&c.set("user_segments",f.split(","));var g=b.allRealtime=c.pluck(c.get("config_segments"),"id"),l=e("expression").eval,j=b.realtime=function(){if(h.isOptOut())return[];for(var a=[],b=c.get("config_segments")||[],e=24*d.HOURS,f=0,g=b.length,j,k;f<g;++f)j=b[f],k="rt_"+j.id,l(j.test)&&d.set(k,"1",e),d.get(k)&&a.push(j.id);return a},m=b.prioritizedSegments=function(){return c.get("prioritized_segments")||[]},k=b.maxSegments=function(){return c.get("max_segments")||0},s=b.compute=function(){if(h.isOptOut())c.set("user_segments",
[]),d.set("segs","");else if(!f){var a;a=(a=d.get("segs"))?a.split(","):[];a=c.difference(a,g);c.set("user_segments",a);var b=j().concat(a);c.set("user_segments",b);d.set("segs",b.join(","));var e=m();a=k();0<e.length&&0<a&&(e=c.filter(e,function(a){return c.contains(b,a)}),e=e.slice(0,a),c.set("user_segments",e),d.set("segs",e.join(",")))}},n=b.handleUserDataResponse=function(a){a.segments&&d.set("segs",a.segments.join(","),72*d.HOURS);a.prvx_segments&&(d.set("prvx_segs",a.prvx_segments.join(","),
72*d.HOURS),c.set("user_prvx_segments",a.prvx_segments));a.shared_segments&&(d.set("shared_segments",a.shared_segments.join(","),72*d.HOURS),c.set("user_shared_segments",a.shared_segments));a.kuid&&(d.set("user",a.kuid,180*d.DAYS),c.set("user",a.kuid));a.technographics&&(d.set("tech",c.paramString(a.technographics),30*d.DAYS),u());a.fp_id&&d.set("fp_id",a.fp_id);s();c.fire("user_data_response",a)},u=b.readTechFromStore=function(){var a=d.get("tech");return a?(1!==c.get("pixel_data__knopii")&&c.eachHash(c.parseKeyValues(a),
function(a,b){c.set("user_attr_kx_tech_"+a,b)}),!0):!1},p={url:c.get("url_userData"),data:{pubid:c.get("pubid")},callback:"kxjsonp_userData",done:n};if(n=d.get("org_user_id"))p.data._kuid=n;if((a=a.get("params.fingerprint"))&&c.get("fp_sent"))a=c.get("fp_id"),p.data.kxfp=c.get("fp"),a&&(p.data.kfuid=a);else if(a&&(a=c.get("fp_id")))p.data.kfuid=a;u()||(p.data.technographics=1);a=b.fetch=function(){c.fireOnce("user_data_request");e("http").jsonp(p)};c.get("segWait")||(c.set("segWait",1,5*d.MINUTES),
c.onOnce("dom:load",a),c.fire("user_data_fetch_scheduled"));d.get("segs");s();a=[];d.get("prvx_segs")&&(a=d.get("prvx_segs").split(","));c.set("user_prvx_segments",a);a=[];d.get("shared_segments")&&(a=d.get("shared_segments").split(","));c.set("user_shared_segments",a);a=c.throttle(s,100);i.user_attr.change(a);i.page_attr.change(a);i.namespace("event").change(s);e("test").module("segments",function(a){c.happened("user_data_fetch_scheduled")&&a("user_data_response",c.happened("user_data_response"))})});
q("sha1",function(b,e){var c=e("crypto-util"),a=e("class").Class,i=e("routes"),h=[],d={20:1518500249,40:1859775393,60:1894007588,80:899497514},f=a.extend(function(a){this._message="";this.reset();this._append(a)},{_minBufferSize:0,finalize:function(){var a=this._data,b=8*c.calculateSigBytesForWords(a);a[b>>>5]|=128<<24-b%32;a[(b+64>>>9<<4)+14]=Math.floor(b/c.MAX_WORD);a[(b+64>>>9<<4)+15]=b;this._process();return String(this)},toString:function(){return c.fromWordsToHex(this._hash)},clone:function(){var a=
new f(this._message);a._hash=this._hash.slice(0);return a},reset:function(){this._hash=this._getInitial();this._data=[];return this},update:function(a){this._append(a);return this},_append:function(a){this._message+=a;a=c.fromUtf8ToWords(a);this._data.push.apply(this._data,a);return this},_process:function(){var a=this._data,b=16*(a.length*c.BYTES_PER_WORD/64),d;if(b){for(d=0;d<b;d+=16)this._processBlock(a,d);d=a.splice(0,b)}return d},_processBlock:function(a,b){for(var c=this._hash,e=c[0],f=c[1],
i=c[2],n=c[3],u=c[4],p=0;80>p;p++){if(16>p)h[p]=a[b+p]|0;else{var r=h[p-3]^h[p-8]^h[p-14]^h[p-16];h[p]=r<<1|r>>>31}r=(e<<5|e>>>27)+u+h[p];r=20>p?r+((f&i|~f&n)+d["20"]):40>p?r+((f^i^n)+d["40"]):60>p?r+((f&i|f&n|i&n)-d["60"]):r+((f^i^n)-d["80"]);u=n;n=i;i=f<<30|f>>>2;f=e;e=r}c[0]=c[0]+e|0;c[1]=c[1]+f|0;c[2]=c[2]+i|0;c[3]=c[3]+n|0;c[4]=c[4]+u|0},_getInitial:function(){var a=[1732584193,4023233417,2562383102,271733878,3285377520];return function(){return a.slice(0)}}()}),a=function(a){return(new f(a)).finalize()};
i.simple("hash:sha1",a);return a});q("sizzle",function(b,e,c){var a=e("util"),e=e("dom"),i=/^(?:(\w+)|(\*(?=\W|$))|\.([\w\-]+)|#([\w\-]+))([#\.\w\-]*)/,h=/^\[([\w\-]+)(?:(\W?=)(["']?)([^\]]*)\3(["']?))?\]/,d=b.attr=e.attr,f=b.hasAttr=function(a,b){var c;return a.hasAttribute?a.hasAttribute(b):!(!(c=a.attributes[b])||!c.nodeValue)},g=function(b,c,e,g){var i=function(a){return function(b){return!!d(b,c).match(a)}},h=g&&a.escapeRegexp(g),e=!e?function(a){return f(a,c)}:"="===e?function(a){return d(a,
c)===g}:"!="===e?function(a){return d(a,c)!==g}:"*="===e?function(a){return 0<=d(a,c).indexOf(g)}:"~="===e?i("(^|\\s)"+h+"(\\s|$)"):"|="===e?i("^"+h+"\\b"):"$="===e?i(h+"$"):"^="===e?i("^"+h):"false";return a.filter(b,e)},l=b.getElementsByClassName=function(b,d){a.isString(b)&&(d=b,b=c.document);return b.getElementsByClassName?b.getElementsByClassName(d):g(b.getElementsByTagName("*"),"class","~=",d)};b.find=function(b,d){d=d||c.document;a.isArray(d)||(d=[d]);for(var e=d,f=[],n,u=0,p=function(b,c){return c[1]?
a.toArray(b.getElementsByTagName(c[1])):c[2]?a.toArray(b.getElementsByTagName("*")):c[3]?a.toArray(l(b,c[3])):c[4]&&(c=b.getElementById(c[4]))?[c]:[]},r=function(){f=f.concat(e===d?[]:e);e=d},t=function(a,b){return function(){var c=n.match(a);if(!c)return 0;b(c);return c[0].length}},o=t(i,function(b){var c=[];a.each(e,function(a){c=c.concat(p(a,b))});e=c;for(var d,f=b[5]||"";d=f.match(/^([\.#])([\w\-]+)/);)e="."===d[1]?g(e,"class","~=",d[2]):g(e,"id","=",d[2]),f=f.slice(d[0].length);if(f)throw"parse error";
}),v=t(h,function(a){e=g(e,a[1],a[2],a[4])}),z=t(/\s*/,function(){}),t=t(/,/,r);n=b.slice(u);){var w;if(!(w=o()))if(!(w=v()))if(!(w=t()))if(!(w=z()))throw"selector parse error";u+=w}r();return f}});q("social",function(b,e,c){var a=e("util");a.on("social",function(b){var d=a.rewriter({facebook:"fb",twitter:"twttr"});e("http").pixel({url:a.get("url_social"),data:{_kpid:a.get("pubid"),_kcp_s:a.get("site"),_ksoc_t:d(b.provider),_ksoc_e:b.action,_ksoc_url:b.url,_kpa_title:c.document.title}})});var i=function(b,
c){a.fire("social",{provider:"facebook",action:b,url:c})},h=b.init_facebook=function(){var b=(b=c.FB)&&(b=b.Event)&&b.subscribe&&a.bind(b.subscribe,b);b?(b("edge.create",a.bind(i,null,"like")),b("edge.remove",a.bind(i,null,"unlike")),b("message.send",a.bind(i,null,"send")),b="done"):b="fail";a.fire("social.init_facebook",{status:b})},d=b.init_twitter=function(){var b=(b=c.twttr)&&(b=b.events)&&b.bind&&a.bind(b.bind,b);b?(b("tweet",function(b){a.fire("social",{provider:"twitter",action:"tweet",url:b&&
b.target&&"IFRAME"===b.target.nodeName?b.target.src:null})}),b="done"):b="fail";a.fire("social.init_twitter",{status:b})};e("routes").simple("social.init",function(){c.setTimeout(function(){h();d()},1E3)})});q("stateful",function(b,e){var c=e("util"),a=e("class").Class,i=e("json").JSON,h=/(?:([a-z]*):)?([^:]+)$/i,d=a.extend(function(a,b){this._type="Stateful";this._raw=a||{};this._defaults=b||{};this._handlers={all:[]}},{get:function(a){var b=this._raw[a];return c.existy(b)?b:this._defaults[a]},set:function(a,
b){var c=this._raw[a];this._raw[a]=b;this._fire("set",a,c,b);return this},has:function(a,b){return c.existy(this._raw[a])||b&&c.existy(this._defaults[a])},remove:function(a,b){var d=this._raw[a];delete this._raw[a];c.existy(d)&&this._fire("remove",a,d,c.UNDEFINED);b&&(d=this._defaults[a],delete this._defaults[a],c.existy(d)&&this._fire("removeDefault",a,d,c.UNDEFINED));return this},watch:function(a,b,d){if(!c.isFunction(b))throw Error("watch expected function, but got: "+String(b)+"\nContext: "+String(this));
var e,i;i=a.match(h);"all"===a?(i="",e=a):!i[1]||"all"===i[1]?(i=i[2],e="all",a=e+":"+i):(e=i[1],i=i[2]);var k=this._mkRemover(a,b);this._addHandler(a,{context:d,fn:b,key:i,remove:k,type:e});return k},toString:function(){return String(this._type)+i.stringify(this._raw)},_fire:function(a,b,d,e,i){var h=this._handlers;c.forEach(h.all.concat(h["all:"+b]||[]).concat(h[a+":"+b]||[]),function(a){a=a.fn.call(a.context||null,b,d,e);c.existy(a)&&((i||this._raw)[b]=a)},this);return this},_addHandler:function(a,
b){var c=this._handlers[a];c||(c=this._handlers[a]=[]);c.push(b);return this},_mkRemover:function(a,b){var d=this;return function(){d._handlers[a]=c.filter(d._handlers[a],function(a){return a.fn!==b})}}});return c.extend(function(a,b){return new d(a,b)},{Stateful:d},b)});q("stats",function(b,e){var c=e("util");e("events");e("data");var a={counter:{},time:{}},i=b.get=function(b,c){return a[b][c]},h=b.set=function(b,c,d){a[b][c]=d};b.time=function(a,b){h("time",a,b)};var d=b.inc=function(a){var b=i("counter",
a)||0;h("counter",a,b+1)},f=b.incPath=function(a){var b=a.split(".");c.times(b.length,function(a){d(c.first(b,a+1).join("."))})},g="."+e("dom").browserBucket,l="."+c.get("config_param_control_tag_version"),j=l+g;f("views"+j);c.get("config_param_control_tag_stats_prefix");c.on("social",function(a){d(a.provider+"."+a.action)});c.on("tag:done",function(){f("tags_delivered"+j)});var m=0;c.on("error",function(){try{10<m||(m++,f("js_errors"+j))}catch(a){}});if(Math.random()<(".alpha"===l?1:".beta"===l||
".stable"===l?0.01:0.001))c.onOnce("tag:all_done",function(){function b(a,c){return"controltagv2."+a+":"+c+"|"+this}var d=c.map(a.counter,c.bind(b,"c")).concat(c.map(a.time,c.bind(b,"ms"))).join(",");e("http").pixel({url:c.get("url_stats"),data:{q:d,format:"gif"}})})});q("store",function(b,e,c){var a=e("util"),i=e("whitelist");e("events");var h;try{h=c.localStorage}catch(d){}var f=c.document,g=["set","get","remove","namespace"],l=g.concat(["clear"]),j="",m=b.whitelist=i(i.ALL);a.forEach(["allowAll",
"allowNone","allowOnly"],function(c){b[c]=a.bind(m[c],m)});i=b.SECONDS=1;i=b.MINUTES=60*i;i=b.HOURS=60*i;b.DAYS=24*i;var k=b.READY_EVENT="store:ready",s=function(a){b.prefix&&0!==a.indexOf(j)&&(a=j+a);return a},n={domain:function(a){return"; domain="+a}},u=function(a){return m.has(b.prefix?a.replace(RegExp("^"+j),""):a)||m.has(a)},p=b.cookie={_COOKIE_START:"(?:^|\\s|;)",set:function(a,b,c,d){return u(a)?p._set.apply(p,arguments):""},get:function(a){var b,a=p._COOKIE_START+a+"=([^;]*)";return f.cookie&&
(b=f.cookie.match(a))&&c.decodeURIComponent(b[1])},remove:function(a){p._set(a,0,-1)},namespace:function(a){var b={};f.cookie.replace(RegExp(p._COOKIE_START+a+"([^=]*)=([^;]*)","g"),function(a,c){b[decodeURIComponent(a)]=decodeURIComponent(c)});return b},clear:function(){a.forEach(f.cookie.split(/\s*;\s*/),function(a){a=a.split("=").shift();u(a)||p.remove(s(a))})},_set:function(a,b,c,d){c=c?"; expires="+(new Date(+new Date+1E3*c)).toUTCString():"";a=a+"="+encodeURIComponent(b)+p._optionsToCookie(d)+
";path=/"+c;return f.cookie=a},_optionsToCookie:function(b){var c="";a.forEach(b,function(a,b){a in n&&(c+=n[a](b))});return c}};if(i=h)var r={set:function(a,b,c){if(!u(a))return"";h.setItem(a,b);c?h.setItem("_"+a,+new Date(+new Date+1E3*c)):h.removeItem("_"+a);return b},get:function(a){var b=h.getItem(a),a=h.getItem("_"+a);return!a?b:a>new Date?b:null},remove:function(a){h.removeItem(a);h.removeItem("_"+a)},namespace:function(a){var c={},d,e;for(e in h)if(d=e.match("^"+a+"(.*)"))c[d[1]]=b.get(d[1]);
return c},clear:function(){for(var a in h)u(a)||t.remove(s(a))}},i=a.reduce(g,function(a,b){a[b]=function(){try{return r[b].apply(r,arguments)}catch(a){}};return a},a.clone(r));var t=b.local=i,e=e("ns"),j=b.prefix="kx"+(e.isDefault?"":e.name+"_");b.init=function(c){var d;if(t&&!c)try{t.set("kxtest","test"),d="test"===t.get("kxtest")&&t,t.remove("kxtest")}catch(e){}var f=d=d||p,c=a.clone(f),c=a.reduce(g,function(b,c){b[c]=function(b){return f[c].apply(f,[s(b||"")].concat(a.rest(arguments)))};return b},
c),r=b.impl=c;a.forEach(l,function(a){b[a]=r[a]});a.fire(k);return r}});q("tag-actions",function(b,e){var c=e("util"),a=e("tag-delivery"),i=e("tag-delivery-timing"),h=e("events").instance;b.DEFAULT="all";var d=c.yes;b[b.DEFAULT]=function(b){h.clear("tag");var e=c.filter(c.get("tags"),function(b){var c=d(b);c&&a.forget(b);return c});i(e);var l;c.on("tag:all_done",l=function(){b(null);c.off("tag:all_done",l)})}});q("tag-delivery-timing",function(b,e){var c=e("util"),a=e("tag-delivery"),i=e("dom");e("store");
var h=b.isDone=function(a){return!!(a.time&&a.time.end||a.error||!1===a.metCriteria)};return c.extend(function(b){c.each(b,a.uniqueName);var e,g=function(){c.all(b,h)&&(g=c.doNothing,c.fireOnce("tag:all_done"))};c.on("tag:done",function(){g()});c.on("tag:fail",function(){g()});g();var l=function(j){e=c.filter(b,function(a){return a.timing===j});c.each(e,function(b){a.meetsCriteria(b)&&a.deliver(b)});g()},j=c.once(l,null,"onload"),m=c.once(l,null,"onready");l("asap");i.ready(m);i.load(j);a.init();
return{deliver:l,isDone:function(){return g!==c.doNothing}}},b,a)});q("tag-delivery",function(b,e,c){var a=e("util"),i=e("config"),h=c.document,d=e("dom"),f=e("geo"),g=e("hash-set"),l=e("ns");e("sizzle");var j=e("store"),m=e("x-frame");e("data");var k=new Date,k=new Date(+k+864E5),s=new Date(k.getFullYear(),k.getMonth(),k.getDate()),n=b.mode="1"===a.param("writeCapture")?"writeCapture":"1"===a.param("writeNativeIframe")?"nativeIframe":"1"===a.param("writeOld")?"old":"newWriter";b.forget=function(a){a.metCriteria=
void 0;a.time={};return a};var u={};a.set("tagsByName",u);var p=b.uniqueName=function(a){if(!a.named){for(var b=a.name,c=1;u[b];)c++,b=a.name+"_"+c;a.name=b;a.named=!0;u[b]=a}},r=function(a,b,e,f){a.root=b;var g=w(a.content),r=c.Krux,j=function(){l.isDefault||(c.Krux=l.self)},h=function(){l.isDefault||(c.Krux=r)},k=function(){e();i().get("remove_kxhead",!0)&&setTimeout(function(){d.remove(b)},250)};"writeCapture"===n?(c.$(b).attr("data-writeCapture","true"),c.$(b).writeCapture().html(g,{done:k})):
"nativeIframe"===a.method||"native"===n&&a.target?(b.ownerDocument.write(g),k()):c.Krux.postscribe(b,g,{afterDequeue:j,afterStreamStart:h,done:k,error:f,name:a.name,releaseAsync:!0})};e("routes").simple("nativeTag",function(c){"native"===n&&b.deliver(a.get("tagsByName")[c])});e("routes").simple("writeHtml",function(a,c,d){b.deliver({name:d||"Anonymous",content:c,target:a[0]||a})});var t=function(a,b){var c;if(a.target){c=a.target;var e;c=c&&c.nodeType?c:c&&(e=c.match(/^(head|body)$/))?h[e[1]]:h.getElementById(c)}else c=
d.kxhead||h.getElementsByTagName("script")[0].parentNode;if(e=c)d[a.target_action||"append"](e,b);return e},o=function(a){var b={"class":"kxtag","data-id":a.id,"data-alias":a.name};b["class"]+=a.target?" kxtargeted":" kxinvisible";return b},v={eval:function(b,c,d){var e;try{e=a.globalEval(b.content)}catch(f){d(f)}c();return e},apply:function(a,b,c){var d;try{d=a.content.apply(null)}catch(e){c(e)}b();return d},document:function(a,b,c){var e=d.createElement("span",o(a));t(a,e)?r(a,e,b,c):b();return e},
iframeCommon:function(a,b,e,f){var g=o(a);g.width=g.height=0;g.scrolling="no";g.style="overflow:hidden;";var j=a.name.match(/(\d+)x(\d+)/);j&&(g.width=j[1]+"px",g.height=j[2]+"px");g=d.createElement("iframe",g);if(t(a,g)){j=g.contentWindow.document;j.open();j.write('<html><head></head><body style="margin:0;">');f.leaveOpen||j.close();if(f.onIframe)f.onIframe(g);g.contentWindow.Krux=c.Krux;r(a,g.contentWindow.document.body,b,e)}else b();return g},nativeIframe:function(a,b,c,d){d.leaveOpen=!0;return v.iframeCommon(a,
b,c,d)},iframe:function(a,b,c,d){return v.iframeCommon(a,b,c,d)}},q=b.templateData=function(){return{pubid:a.get("pubid"),site:a.get("site"),geo:f.get(),now:new Date}},w=b.runTemplate=function(b,c){e("underscore").templateSettings={evaluate:/\{%([\s\S]+?)%\}/g,interpolate:/\{\{([\s\S]+?)\}\}/g,escape:/\{%-([\s\S]+?)%\}/g};q.now=new Date;return a.template(b,c||q())};b.meetsCriteria=function(b){if(b.once_per_page&&y.has(b))return b.metCriteria=!1;if(!b.criteria)return b.metCriteria=!0;if("native"===
n&&b.target)return b.metCriteria=!1;a.set("now",new Date);if(b.freq_cap){var c=+j.get("tag"+b.id+".day")||0;a.set("tag_deliveries_today",c)}return b.metCriteria=e("expression").eval(b.criteria)};var x=0,y=l.self._oneTimeTags=l.self._oneTimeTags||g(function(a){return a.id});b.deliver=function(b,c){var d=b.once_per_page;if(d&&y.has(b))return y.get(b).id;c=c||{};p(b);b.id=b.id||x++;b.time={mode:"async",start:a.ms()};b.method=b.method||(a.isFunction(b.content)?"apply":"document");"nativeIframe"===n&&
b.target&&(b.method="nativeIframe");var e=function(c){b.error=c&&c.message&&c||{message:"unknown error"};a.fire("tag:fail",{id:b.id,alias:b.name,error:b.error.message})};a.fire("tag:started",{id:b.id,alias:b.name});var f;try{return f=v[b.method](b,function(){b.time.end=a.ms();b.time.duration=b.time.end-b.time.start;if(b.freq_cap){var c="tag"+b.id+".day",d=+j.get(c)||0;j.set(c,d+1,(s-new Date)/1E3)}a.fire("tag:done",{id:b.id,alias:b.name})},e,c),d&&y.put({id:b.id}),f}catch(g){return e(g),null}};b.claimOneTimers=
function(b){var b=a.filter(b,function(a){return a.once_per_page}),c=a.now(),d=a.map(b,function(a){return{id:a.id,claimId:c}});d.length&&(m.broadcast({tags:d}),m.listen(function(b){b=b.data.tags;b=a.filter(b,function(b){var c=a.find(d,function(a){return a.id===b.id});return b.claimId<c.claimId});y.put.apply(y,b)}))};b.init=a.once(function(){e("test").module("tag-delivery",function(b){var c={};a.each(a.get("tags"),function(d){!a.happened("dom:beforeunload")&&!a.happened("dom:unload")&&b("tag_considered",
null!=d.metCriteria,d.name);if(d.metCriteria){var e=d.time||{},f=e.start;b("tag_delivered",e.end,d.name);e=d.timing;b("tag_valid_timing_name",e,e);e=c[e]=c[e]||{lastStart:0};b("tag_order",f>=e.lastStart,d.name);e.lastStart=f}})})})});q("tag",function(b,e){var c=e("util"),a=e("tag-actions"),i=e("tag-delivery-timing"),h=e("routes"),d=e("store");e("x-frame");e("data");c.extend(b,i,{Timing:i});b.init=function(){var a=d.get("org_user_id")||d.get("kuid");a&&c.set("user",a);c.onOnce("user_data_response",
function(){var a=c.get("user");a&&d.set("kuid",a)});i(c.get("tags"))};h.regexp(/^tag:reload:?(.*)$/,function(b,c){var d=b[1]||a.DEFAULT;if(d in a)try{a[d](c)}catch(e){c(e)}else c(new TypeError("Krux('tags') has no method: "+d))})});q("template",function(b){var e={},c="undefined"!==typeof b?b:e,a=function(a){return String(null===a||void 0===a?"":a)},i=function(a,b,c){var d;b&&"object"===typeof b&&(null!=b[a]?d=b[a]:c&&(b.get&&"function"===typeof b.get)&&(d=b.get(a)));return d};c.Template=function(a,
b,c,d){a=a||{};this.r=a.code||this.r;this.c=c;this.options=d||{};this.text=b||"";this.partials=a.partials||{};this.subs=a.subs||{};this.buf=""};c.Template.prototype={r:function(){return""},v:function(b){b=a(b);return j.test(b)?b.replace(h,"&amp;").replace(d,"&lt;").replace(f,"&gt;").replace(g,"&#39;").replace(l,"&quot;"):b},t:a,render:function(a,b,c){return this.ri([a],b||{},c)},ri:function(a,b,c){return this.r(a,b,c)},ep:function(a,b){var c=this.partials[a],d=b[c.name];if(c.instance&&c.base===d)return c.instance;
if("string"===typeof d){if(!this.c)throw Error("No compiler available.");d=this.c.compile(d,this.options)}if(!d)return null;this.partials[a].base=d;if(c.subs){b.stackText||(b.stackText={});for(var e in c.subs)b.stackText[e]||(b.stackText[e]=void 0!==this.activeSub&&b.stackText[this.activeSub]?b.stackText[this.activeSub]:this.text);e=d;var d=c.subs,c=c.partials,f=this.stackSubs,g=this.stackPartials,r=b.stackText,j=function(){},i=function(){};j.prototype=e;i.prototype=e.subs;var h;e=new j;e.subs=new i;
e.subsText={};e.buf="";f=f||{};e.stackSubs=f;e.subsText=r;for(h in d)f[h]||(f[h]=d[h]);for(h in f)e.subs[h]=f[h];g=g||{};e.stackPartials=g;for(h in c)g[h]||(g[h]=c[h]);for(h in g)e.partials[h]=g[h];d=e}return this.partials[a].instance=d},rp:function(a,b,c,d){a=this.ep(a,c);return!a?"":a.ri(b,c,d)},rs:function(a,b,c){var d=a[a.length-1];if(m(d))for(var e=0;e<d.length;e++)a.push(d[e]),c(a,b,this),a.pop();else c(a,b,this)},s:function(a,b,c,d,e,f,g){if(m(a)&&0===a.length)return!1;"function"===typeof a&&
(a=this.ms(a,b,c,d,e,f,g));c=!!a;!d&&(c&&b)&&b.push("object"===typeof a?a:b[b.length-1]);return c},d:function(a,b,c,d){var e=a.split("."),f=this.f(e[0],b,c,d),g=this.options.modelGet,r=null;if("."===a&&m(b[b.length-2]))f=b[b.length-1];else for(var j=1;j<e.length;j++)a=i(e[j],f,g),null!=a?(r=f,f=a):f="";if(d&&!f)return!1;!d&&"function"===typeof f&&(b.push(r),f=this.mv(f,b,c),b.pop());return f},f:function(a,b,c,d){for(var e=!1,f=null,g=!1,r=this.options.modelGet,j=b.length-1;0<=j;j--)if(f=b[j],e=i(a,
f,r),null!=e){g=!0;break}if(!g)return d?!1:"";!d&&"function"===typeof e&&(e=this.mv(e,b,c));return e},ls:function(b,c,d,e,f){var g=this.options.delimiters;this.options.delimiters=f;this.b(this.ct(a(b.call(c,e)),c,d));this.options.delimiters=g;return!1},ct:function(a,b,c){if(this.options.disableLambda)throw Error("Lambda features disabled.");return this.c.compile(a,this.options).render(b,c)},b:function(a){this.buf+=a},fl:function(){var a=this.buf;this.buf="";return a},ms:function(a,b,c,d,e,f,g){b=
b[b.length-1];a=a.call(b);if("function"===typeof a){if(d)return!0;d=this.activeSub&&this.subsText&&this.subsText[this.activeSub]?this.subsText[this.activeSub]:this.text;return this.ls(a,b,c,d.substring(e,f),g)}return a},mv:function(b,c,d){c=c[c.length-1];b=b.call(c);return"function"===typeof b?this.ct(a(b.call(c)),c,d):b},sub:function(a,b,c,d){var e=this.subs[a];e&&(this.activeSub=a,e(b,c,this,d),this.activeSub=!1)}};var h=/&/g,d=/</g,f=/>/g,g=/\'/g,l=/\"/g,j=/[&<>\"\']/,m=Array.isArray||function(a){return"[object Array]"===
Object.prototype.toString.call(a)},k="undefined"!==typeof b?b:e,s=function(a){return a.trim?a.trim():a.replace(/^\s*|\s*$/g,"")},n=function(a,b,c){if(b.charAt(c)!==a.charAt(0))return!1;for(var d=1,e=a.length;d<e;d++)if(b.charAt(c+d)!==a.charAt(d))return!1;return!0},q=function(a,b,c,d){for(var b=[],e=null,f=e=null,e=c[c.length-1];0<a.length;){f=a.shift();if(e&&"<"===e.tag&&!(f.tag in B))throw Error("Illegal content in < super tag.");var g;if(!(g=k.tags[f.tag]<=k.tags.$))a:{g=f;for(var r=d,j=0,h=r.length;j<
h;j++)if(r[j].o===g.n){g.tag="#";g=!0;break a}g=void 0}if(g)c.push(f),f.nodes=q(a,f.tag,c,d);else{if("/"===f.tag){if(0===c.length)throw Error("Closing tag without opener: /"+f.n);e=c.pop();if(a=f.n!==e.n){a:{a=0;for(c=d.length;a<c;a++)if(d[a].c===f.n&&d[a].o===e.n){d=!0;break a}d=void 0}a=!d}if(a)throw Error("Nesting error: "+e.n+" vs. "+f.n);e.end=f.i;return b}"\n"===f.tag&&(f.last=0===a.length||"\n"===a[0].tag)}b.push(f)}if(0<c.length)throw Error("missing closing tag: "+c.pop().n);return b},p=function(a){var b=
[],c;for(c in a.partials)b.push('"'+r(c)+'":{name:"'+r(a.partials[c].name)+'", '+p(a.partials[c])+"}");var b="partials: {"+b.join(",")+"}, subs: ",d,a=a.subs;c=[];for(d in a)c.push('"'+r(d)+'": function(c,p,t,i) {'+a[d]+"}");d="{ "+c.join(",")+" }";return b+d},r=function(a){return a.replace(y,"\\\\").replace(z,'\\"').replace(w,"\\n").replace(x,"\\r")},t=function(a){return~a.indexOf(".")?"d":"f"},o=function(a,b){var c="<"+(b.prefix||"")+a.n+D++;b.partials[c]={name:a.n,partials:{}};b.code+='t.b(t.rp("'+
r(c)+'",c,p,"'+(a.indent||"")+'"));';return c},b=function(a,b){b.code+="t.b(t.t(t."+t(a.n)+'("'+r(a.n)+'",c,p,0)));'},v=/\S/,z=/\"/g,w=/\n/g,x=/\r/g,y=/\\/g;k.tags={"#":1,"^":2,"<":3,$:4,"/":5,"!":6,">":7,"=":8,_v:9,"{":10,"&":11,_t:12};k.scan=function(a,b){function c(){0<r.length&&(h.push({tag:"_t",text:String(r)}),r="")}function d(a,b){c();var e;if(e=a)a:{e=!0;for(var f=l;f<h.length;f++)if(e=k.tags[h[f].tag]<k.tags._v||"_t"===h[f].tag&&null===h[f].text.match(v),!e){e=!1;break a}}if(e){e=l;for(var g;e<
h.length;e++)if(h[e].text){if((g=h[e+1])&&">"===g.tag)g.indent=h[e].text.toString();h.splice(e,1)}}else b||h.push({tag:"\n"});i=!1;l=h.length}var e=a.length,f=0,g=null,j=null,r="",h=[],i=!1,o=0,l=0,m="{{",t="}}";b&&(b=b.split(" "),m=b[0],t=b[1]);for(o=0;o<e;o++)0===f?n(m,a,o)?(--o,c(),f=1):"\n"===a.charAt(o)?d(i):r+=a.charAt(o):1===f?(o+=m.length-1,g=(j=k.tags[a.charAt(o+1)])?a.charAt(o+1):"_v","="===g?(m=a,j=o,o="="+t,f=m.indexOf(o,j),t=s(m.substring(m.indexOf("=",j)+1,f)).split(" "),m=t[0],t=t[t.length-
1],o=f+o.length-1,f=0):(j&&o++,f=2),i=o):n(t,a,o)?(h.push({tag:g,n:s(r),otag:m,ctag:t,i:"/"===g?i-m.length:o+t.length}),r="",o+=t.length-1,f=0,"{"===g&&("}}"===t?o++:(j=h[h.length-1],"}"===j.n.substr(j.n.length-1)&&(j.n=j.n.substring(0,j.n.length-1))))):r+=a.charAt(o);d(i,!0);return h};var B={_t:!0,"\n":!0,$:!0,"/":!0};k.stringify=function(a){return"{code: function (c,p,i) { "+k.wrapMain(a.code)+" },"+p(a)+"}"};var D=0;k.generate=function(a,b,c){D=0;var d={code:"",subs:{},partials:{}};k.walk(a,d);
return c.asString?this.stringify(d,b,c):this.makeTemplate(d,b,c)};k.wrapMain=function(a){return'var t=this;t.b(i=i||"");'+a+"return t.fl();"};k.template=k.Template;k.makeTemplate=function(a,b,c){var d=this.makePartials(a);d.code=new Function("c","p","i",this.wrapMain(a.code));return new this.template(d,b,this,c)};k.makePartials=function(a){var b,c={subs:{},partials:a.partials,name:a.name};for(b in c.partials)c.partials[b]=this.makePartials(c.partials[b]);for(b in a.subs)c.subs[b]=new Function("c",
"p","t","i",a.subs[b]);return c};k.codegen={"#":function(a,b){b.code+="if(t.s(t."+t(a.n)+'("'+r(a.n)+'",c,p,1),c,p,0,'+a.i+","+a.end+',"'+a.otag+" "+a.ctag+'")){t.rs(c,p,function(c,p,t){';k.walk(a.nodes,b);b.code+="});c.pop();}"},"^":function(a,b){b.code+="if(!t.s(t."+t(a.n)+'("'+r(a.n)+'",c,p,1),c,p,1,0,0,"")){';k.walk(a.nodes,b);b.code+="};"},">":o,"<":function(a,b){var c={partials:{},code:"",subs:{},inPartial:!0};k.walk(a.nodes,c);var d=b.partials[o(a,b)];d.subs=c.subs;d.partials=c.partials},$:function(a,
b){var c={subs:{},code:"",partials:b.partials,prefix:a.n};k.walk(a.nodes,c);b.subs[a.n]=c.code;b.inPartial||(b.code+='t.sub("'+r(a.n)+'",c,p,i);')},"\n":function(a,b){b.code+='t.b("\\n"'+(a.last?"":" + i")+");"},_v:function(a,b){b.code+="t.b(t.v(t."+t(a.n)+'("'+r(a.n)+'",c,p,0)));'},_t:function(a,b){var c=b.code,d='"'+r(a.text)+'"';b.code=c+("t.b("+d+");")},"{":b,"&":b};k.walk=function(a,b){for(var c,d=0,e=a.length;d<e;d++)(c=k.codegen[a[d].tag])&&c(a[d],b);return b};k.parse=function(a,b,c){c=c||
{};return q(a,"",[],c.sectionTags||[])};k.cache={};k.cacheKey=function(a,b){return[a,!!b.asString,!!b.disableLambda,b.delimiters,!!b.modelGet].join("||")};k.compile=function(a,b){var b=b||{},c=k.cacheKey(a,b),d=this.cache[c];if(d){var c=d.partials,e;for(e in c)delete c[e].instance;return d}d=this.generate(this.parse(this.scan(a,b.delimiters),a,b),a,b);return this.cache[c]=d}});q("test-visualtags",function(b,e){function c(a){return-1<(""+a).indexOf("px")?parseInt(a.replace("px",""),10)||0:0}function a(a,
b){return Math.floor(100*(Math.abs(a-b)/b))}function i(a,b){return b["offset"+("width"===a?"Width":"Height")]||0}function h(a,b){g++;if(1E3<g)return 0;for(var c=0,d="offset"+("width"===a?"Width":"Height"),e=0;e<b.childNodes.length;e++)c=Math.max(c,b.childNodes[e][d]||0),b.childNodes[e].childNodes.length&&(c=Math.max(c,h(a,b.childNodes[e])));return c}var d=e("util"),f=e("sizzle").find;b.init=function(){e("test").module("visualtags",function(b){for(var e=f(".kxtargeted"),g=0,k=e.length;g<k;g++){var s=
e[g].getAttribute("data-id"),n=e[g].getAttribute("data-alias");a:{var q=d.get("tagsByName"),p=void 0;for(p in q)if(q[p].id===s){s=q[p].target||"";break a}s=""}s=f("#"+s);s=1===s.length?s[0]:e[g].parentNode;q=Math.max(i("width",e[g]),h("width",s));p=Math.max(i("height",e[g]),h("height",s));b("visualtag-not-blank",q*p,"Tag area appears to be empty ("+n+")");s.style&&c(s.style.width)&&b("visualtag-expected-width",10>a(c(s.style.width),q),"Tag width ain't right ("+n+")");s.style&&c(s.style.height)&&b("visualtag-expected-height",
10>a(c(s.style.height),p),"Tag height ain't right ("+n+")")}})};var g=0});q("test",function(b,e,c){var a=e("util"),i={},h="test";b.status="NOT_STARTED";var d=b.test=function(c,d,e){var f=d?"pass":"fail";b.results.push({module:h,code:c,data:e,assertion:d,time:new Date,status:f});a.fire("test:"+f,{code:c,data:e});return d},f=function(b,c){return a.isArray(b)&&a.isArray(c)?b.length===c.length&&a.all(b,function(a,b){return f(a,c[b])}):b===c};d.eq=function(a,b,c){return d(a,f(b,c),{actual:b,expected:c})};
b.module=function(a,c){"NOT_STARTED"!==b.status&&d("tests_not_started",!1,b.status);i[a]=c};var g=function(a,b){h=a;try{b(d)}catch(c){d("tests_module_threw",!1,"module_"+a+"_threw:"+c.message)}},l=b.run=function(){b.results=[];b.failureGroup=null;d("tests_to_run",!a.isEmpty(i));a.eachHash(i,g);var e=b.report=a.groupBy(b.results,"status");e.total=b.results.length;e.toString=function(){try{var d=[],e=function(){d.push(Array.prototype.join.call(arguments,""))};e("Test Summary: "+b.status);e("Version: "+
c.Krux.version+", "+c.Krux.commit);b.failureGroup&&e("Failure Group:"+b.failureGroup);e("Phase: "+b.phase);e("Status,Code,Data");a.each(b.results,function(a){e(a.status,",",a.code,",",a.data)});return d.join("\n")}catch(f){return"report.toString failed: "+f}};var f=b.status=e.status=e.fail?"FAIL":"PASS";if("PASS"!==f){var h=-1,l,n=1E3,q=[],p={tests_to_run:n--,tests_module_threw:n--,pixel:n--,tag_delivered:n--};a.each(e.fail,function(a){var b=p[a.code]||0;q.push(a.code+": "+a.data);b>h&&(h=b,l=a)});
b.failureGroup=l.code+(l.data?":"+l.data:"");b.phase=a.happened("dom:load")?"after_load":a.happened("dom:ready")?"after_ready_before_load":"before_ready"}a.fire("test:all_done",{status:f})};b.init=function(){var b=a.once(l);a.on("pixel",b);a.on("dom:beforeunload",b);a.on("dom:unload",b)}});q("timing",function(b,e){var c=e("data"),a=Date.now||function(){return(new Date).getTime()},i=function(b){return function(){c.set(b,a())}};return{start:i("started"),end:i("ended")}});q("underscore",function(b,e,
c){var a=function(b){if(b instanceof a)return b;if(!(this instanceof a))return new a(b);this._wrapped=b},i={},h=Array.prototype,d=Object.prototype,f=h.slice,g=d.toString,l=d.hasOwnProperty,j=h.map,m=h.filter,k=h.every,s=h.some,n=h.indexOf,h=Array.isArray,q=a.each=a.forEach=function(a,b,c){if(null!=a)if(a.length===+a.length)for(var d=0,e=a.length;d<e&&!(d in a&&b.call(c,a[d],d,a)===i);d++);else for(d in a)if(l.call(a,d)&&b.call(c,d,a[d],a)===i)break};a.map=function(a,b,c){var d=[];if(null==a)return d;
if(j&&a.map===j)return a.map(b,c);q(a,function(a,e,f){d[d.length]=b.call(c,a,e,f)});return d};a.find=a.detect=function(a,b,c){var d;p(a,function(a,e,f){if(b.call(c,a,e,f))return d=a,!0});return d};a.every=a.all=function(a,b,c){var d=!0;if(null==a)return d;if(k&&a.every===k)return a.every(b,c);q(a,function(a,e,f){if(!(d=d&&b.call(c,a,e,f)))return i});return d};var p=a.some=a.any=function(b,c,d){var c=c||a.identity,e=!1;if(null==b)return e;if(s&&b.some===s)return b.some(c,d);q(b,function(a,b,f){if(e||
(e=c.call(d,a,b,f)))return i});return!!e};a.include=a.contains=function(a,b){var c=!1;return null==a?c:n&&a.indexOf===n?-1!=a.indexOf(b):c=p(a,function(a){return a===b})};a.filter=a.select=function(a,b,c){var d=[];if(null==a)return d;if(m&&a.filter===m)return a.filter(b,c);q(a,function(a,e,f){b.call(c,a,e,f)&&(d[d.length]=a)});return d};a.reduce=a.foldl=a.inject=function(a,b,c,d){var e=2<arguments.length;null==a&&(a=[]);q(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)});if(!e)throw new TypeError("Reduce of empty array with no initial value");
return c};a.indexOf=function(a,b){if(null==a)return-1;var c,d;if(n&&a.indexOf===n)return a.indexOf(b);c=0;for(d=a.length;c<d;c++)if(c in a&&a[c]===b)return c;return-1};a.uniq=a.unique=function(b,c,d){var d=d?a.map(b,d):b,e=[];3>b.length&&(c=!0);a.reduce(d,function(d,f,g){if(c?a.last(d)!==f||!d.length:!a.include(d,f))d.push(f),e.push(b[g]);return d},[]);return e};a.difference=function(b){var c=a.flatten(f.call(arguments,1),!0);return a.filter(b,function(b){return!a.include(c,b)})};a.flatten=function(b,
c){return a.reduce(b,function(b,d){if(a.isArray(d))return b.concat(c?d:a.flatten(d));b[b.length]=d;return b},[])};a.intersection=a.intersect=function(b){var c=f.call(arguments,1);return a.filter(a.uniq(b),function(b){return a.every(c,function(c){return 0<=a.indexOf(c,b)})})};a.groupBy=function(b,c){var d={},e=a.isFunction(c)?c:function(a){return a[c]};q(b,function(a,b){var c=e(a,b);(d[c]||(d[c]=[])).push(a)});return d};a.compact=function(b){return a.filter(b,function(a){return!!a})};a.invoke=function(b,
c){var d=f.call(arguments,2);return a.map(b,function(b){return(a.isFunction(c)?c||b:b[c]).apply(b,d)})};a.pluck=function(b,c){return a.map(b,function(a){return a[c]})};a.identity=function(a){return a};a.values=function(b){return a.map(b,a.identity)};a.times=function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)};a.clone=function(b){return!a.isObject(b)?b:a.isArray(b)?b.slice():a.extend({},b)};a.extend=function(a){q(f.call(arguments,1),function(b){for(var c in b)void 0!==b[c]&&(a[c]=b[c])});return a};a.defaults=
function(a){q(f.call(arguments,1),function(b){for(var c in b)null==a[c]&&(a[c]=b[c])});return a};a.first=a.head=function(a,b,c){return null!=b&&!c?f.call(a,0,b):a[0]};a.initial=function(a,b,c){return f.call(a,0,a.length-(null==b||c?1:b))};a.last=function(a,b,c){return null!=b&&!c?f.call(a,Math.max(a.length-b,0)):a[a.length-1]};a.rest=a.tail=function(a,b,c){return f.call(a,null==b||c?1:b)};a.size=function(b){return null==b?0:b.length===+b.length?b.length:a.keys(b).length};a.toArray=function(b){return!b?
[]:b.toArray?b.toArray():a.isArray(b)||a.isArguments(b)?f.call(b):a.values(b)};a.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};a.template=function(b,c){var d=a.templateSettings,d="var __p=[],print=function(){__p.push.apply(__p,arguments);};with(obj||{}){__p.push('"+b.replace(/\\/g,"\\\\").replace(/'/g,"\\'").replace(d.escape,function(a,b){return"',_.escape("+b.replace(/\\'/g,"'")+
"),'"}).replace(d.interpolate,function(a,b){return"',"+b.replace(/\\'/g,"'")+",'"}).replace(d.evaluate||null,function(a,b){return"');"+b.replace(/\\'/g,"'").replace(/[\r\n\t]/g," ")+";__p.push('"}).replace(/\r/g,"\\r").replace(/\n/g,"\\n").replace(/\t/g,"\\t")+"');}return __p.join('');",e=new Function("obj","_",d);return c?e(c,a):function(b){return e.call(this,b,a)}};a.isEmpty=function(b){if(a.isArray(b)||a.isString(b))return 0===b.length;for(var c in b)if(l.call(b,c))return!1;return!0};a.isElement=
function(a){return!!(a&&1==a.nodeType)};a.isArray=h||function(a){return"[object Array]"==g.call(a)};a.isObject=function(a){return a===Object(a)};a.isArguments="[object Arguments]"==g.call(arguments)?function(a){return"[object Arguments]"==g.call(a)}:function(a){return!(!a||!l.call(a,"callee"))};a.isFunction=function(a){return"[object Function]"==g.call(a)};a.isString=function(a){return"[object String]"==g.call(a)};a.isNumber=function(a){return"[object Number]"==g.call(a)};a.isNaN=function(a){return a!==
a};a.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==g.call(a)};a.isDate=function(a){return"[object Date]"==g.call(a)};a.isRegExp=function(a){return"[object RegExp]"==g.call(a)};a.isNull=function(a){return null===a};a.isUndefined=function(a){return void 0===a};a.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);for(var c=arguments[2]||1,d=Math.max(Math.ceil((b-a)/c),0),e=0,f=Array(d);e<d;)f[e++]=a,a+=c;return f};a.now=Date.now||function(){return(new Date).getTime()};a.throttle=
function(b,c,d){var e,f,g,h=null,j=0;d||(d={});var i=function(){j=!1===d.leading?0:a.now();h=null;g=b.apply(e,f);e=f=null};return function(){var k=a.now();!j&&!1===d.leading&&(j=k);var l=c-(k-j);e=this;f=arguments;0>=l?(clearTimeout(h),h=null,j=k,g=b.apply(e,f),e=f=null):!h&&!1!==d.trailing&&(h=setTimeout(i,l));return g}};a.partial=function(b){var c=f.call(arguments,1);return function(){for(var d=0,e=c.slice(),f=0,g=e.length;f<g;f++)e[f]===a&&(e[f]=arguments[d++]);for(;d<arguments.length;)e.push(arguments[d++]);
return b.apply(this,e)}};a.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,b)];return b[0]}};return a});q("util",function(b,e,c){var a=e("underscore");a.extend(b,a,{_:a});a=b;a.UNDEFINED=void 0;a.globalEval=function(a,b){b=b||c;a&&/\S/.test(a)&&b.eval.call(b,a)};a.parseParams=a.parseKeyValues=function(b,c,e,h){var c=c||"&",e=e||"=",h=h||decodeURIComponent,j={};if("string"!==typeof b)return j;b.replace(RegExp(c+"*([^"+e+c+"]+)"+e+"([^"+
c+"]+)"+c+"*","g"),function(b,c,d){var e;try{e=h(d)}catch(f){e=d}d=e;j[c]=!j[c]?d:a.isArray(j[c])?j[c].concat([d]):[j[c],d]});return j};a.urlParams=function(b){b=(b||c.location.href).match(/[^\#?]+(?:\?([^#]*))?(?:#(.*))?/);return a.parseParams(a.compact(b.slice(1)).join("&"))};a.paramString=function(b,c,e,h){var c=c||"&",e=e||"=",h=h||encodeURIComponent,j=[];a.eachHash(b,function(b,c){c=a.isArray(c)?c:[c];a.each(c,function(a){null!=a&&""!==a&&j.push(h(b)+e+h(a))})});return j.join(c)};a.isPrimitive=
function(b){return null==b||!/^object|function$/.test(typeof b)&&!a.isNaN(b)};a.isSerializable=function(b){return a.isPrimitive(b)||!/[object [^\]]*]/.test(String(b))};a.without=a.remove=function(b,c){return a.filter(b,function(a){return a!==c})};var i=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");a.escapeRegexp=function(a){return(""+a).replace(i,"\\$1")};a.doNothing=a.noop=function(){};a.defer=function(b){var e=a.rest(arguments);c.setTimeout(function(){b.apply(null,e)},0)};
var h=[];h.toString=function(){return e("json").JSON.stringify(h)};a.log=function(b){if(a.isString(b))c.console&&console.log(b);else if(b)b.time=new Date,h.push(b);else return h};a.Set=function(a){for(var b=0;b<a.length;b++)this[a[b]]=!0};a.negate=function(a){return function(){return!a.apply(this,arguments)}};a.G=c;a.bind=function(b,c){if(b.isBound&&3>arguments.length)return b;var e=a.rest(arguments,2),h=function(){return b.apply(c,e.concat(a.toArray(arguments)))};h.actual=b;h.isBound=!0;return h};
a.bindMethod=function(b,c){a.each(b.split(" "),function(b){c[b]=a.bind(c[b],c)})};a.interpolate=function(a,b){return b.replace(/\$\{([^{}]*)\}/g,function(b,c){var e=a[c];return"string"===typeof e||"number"===typeof e?e:b})};a.rewriter=function(a){return function(b){return a[b]||b}};a.extend(a,{max:Math.max,min:Math.min});a.once=function(b){if(b.isOnce&&3>arguments.length)return b;var c=!1,b=a.bind.apply(null,arguments),e=function(){return!c&&(c=!0)&&b.apply(null,arguments)};e.isOnce=!0;e.actual=b;
return e};a.ms=function(){return new Date-a.get("started")};a.param=function(a){var b;return(b=c.location.href.match("\\bkx"+a+"(?:=|\\b)([^&#]*)"))&&(b[1]||!0)};a.eachHash=a.each;a.mapHash=function(b,c,e){var h={};a.eachHash(b,function(a,i){var k=c.call(e,a,i,b);h[k[0]]=k[1]});return h};a.anyHash=a.any;a.findHash=a.find;a.keys=function(b){return a.map(b,function(a){return a})};a.values=function(b){return a.map(b,function(a,b){return b})};a.say=function(){};a.property=function(a){var b=function(a){return arguments.length?
b.set(a):b.get()};b.get=a.get;b.set=a.set;a.value&&b.set(a.value);return b};a.attributes=function(b){var c=function(b,d){var e=arguments.length;return 0===e?c.all():!a.isString(b)?c.set(b):1===e?c.get(b):c.set(b,d)};c.get=b.get;c.all=b.all;c.set=function(c,e){return 1===arguments.length?a.each(c,b.set):b.set(c,e)};b.values&&c.set(b.values);return c};a.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);for(var c=arguments[2]||1,e=Math.max(Math.ceil((b-a)/c),0),h=0,i=Array(e);h<e;)i[h++]=a,a+=
c;return i};a.deref=a.dereference=function(b,e){1===arguments.length&&(e=b,b=c);try{return a.reduce(e.split("."),function(a,b){return a[b]},b)}catch(g){}};a.sum=function(b){a.isArray(b)||(b=a.toArray(arguments));return a.reduce(b,function(a,b){return a+b},0)};a.yes=function(){return!0};a.not=function(a){return!a};a.kruxDomain=function(a){a=String(a).replace(/:\d+$/,"");return/(?:\d{1,3}\.){3}\d{1,3}/.test(a)?"":a.replace(/.*?((?:(^|\.)[^\.]+){1,2}(?:\.com)?)$/,"$1").replace(/^\./,"")};a.existy=function(b){return null!==
b&&b!==a.UNDEFINED};a.matchAll=function(b,c){return a.all(a.toArray(arguments).slice(1),function(c){return a.isFunction(c.test)?c.test(b):-1!==b.indexOf(c)})}});q("version",function(b){b.version="5.33.11";b.commit="0d6268ef6da31b7b46a9a676979dbb59800b4b54"});q("whitelist",function(b,e){function c(b){var c=a.toArray(arguments);c.unshift(String);i.HashSet.apply(this,c)}var a=e("util"),i=e("hash-set"),h={toString:function(){return"ALL"}},d={toString:function(){return"NONE"}};c.ALL=h;c.NONE=d;c.prototype=
i();a.extend(c.prototype,{_parent:i.HashSet.prototype,get:function(a){return this._all()||this._none()?this._all()?a:null:this._parent.get.apply(this,arguments)},has:function(a){return!this._none()&&this._all()||this._parent.has.apply(this,arguments)||this._hasMatch(a)},put:function(a){if(this._all()||this._none())this._items={};return this._parent.put.apply(this,arguments)},allowOnly:function(a){this.empty();return this.put.apply(this,arguments)},allowAll:function(){this.empty();this._items=h;return this},
allowNone:function(){this.empty();this._items=d;return this},toString:function(){return a.isSerializable(this._items)?String(this._items):this._parent.toString.call(this)},_hasMatch:function(b){this._thunk();return a.any(this._items,function(c,d){return d.test&&a.isFunction(d.test)&&d.test(b)})},_all:function(){return this._items===h},_none:function(){return this._items===d}});return a.extend(function(a){var b=new c;!a||a===h?b.allowAll():a===d?b.allowNone():b.put.apply(b,arguments);return b},{Whitelist:c,
ALL:h,NONE:d})});q("x-frame",function(b,e,c){var a=e("util"),i=e("dom"),h=e("json").JSON,d=i.d2on,f=c.location.origin,g=b.isFramed=function(){return c.top!==c},l=b.send=function(b,c,d){if(a.isFunction(b.postMessage))try{"document"in b&&b.postMessage(h.stringify(c),d)}catch(e){}};b.broadcast=function(b,d){var d=a.defaults(d||{},{container:!0,domain:f,self:!1}),e=g()?c.parent:c;d.container&&(g()||d.self)&&l(e,b,d.domain);for(var h=0,e=e.frames,i=e.length;h<i;++h)(e[h]!==c||d.self)&&l(e[h],b,d.domain)};
b.listen=function(b,e){var g=a.defaults(e||{},{origin:f,strict:!0,win:c.window});return d(g.win,"message",function(c){if(!g.strict||0===String(c.origin||"").indexOf(g.origin))b.call(this,{data:a.isString(c.data)?h.parse(c.data):c.data,event:c})})};b.init=function(a){f=a}});B("index")})();
