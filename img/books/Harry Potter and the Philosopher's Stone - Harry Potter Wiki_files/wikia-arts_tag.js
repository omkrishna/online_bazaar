/*
 (c) 2011 - 2014 Magnetic Media Online, Inc.
 Version: 0.7
 Date: 1419655527.890356
 Privacy: http://www.magnetic.com/privacy/corporate-privacy-policy/
*/
if("undefined"==typeof _mag){var _mag={};_mag.settings={}}"undefined"==typeof console&&(console={},console.log=function(){}),"function"!=typeof String.prototype.trim&&(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")}),function(){function e(){r.initSettings(),n.init(t),t.bestTemplateResults=i.init(t.templates)||{},t.intervals=t.maxTries,r.searchReady()||(r.log("starting intervals"),t.readyInterval=window.setInterval(r.searchReady,100)),t.debugMode&&(_mag.Smag=r,_mag.PixelsController=n,_mag.Parser=i)}var t="settings"in _mag?_mag.settings:{},r={initSettings:function(){r.log("init settings."),t.defaultKeywords="keyword",t.publisherKeywords="kw"in _mag?_mag.kw:null,t.ns=null,t.keywordSource="pub",t.startTime="startTime"in _mag?_mag.startTime:"0",t.tagVersion="0.7",t.executeTime=(new Date).getTime(),t.debugMode="debugMode"in t&&t.debugMode?!0:!1,t.isIFrame=~~(window!=window.top),t.isSecure="https:"==document.location.protocol,t.protocol=t.isSecure?"https:":"http:",t.currentURL=window.location,t.publicHost=r.getPublicHost(),t.refURL=r.getReferrerUrl(),t.title=document.title.substr(0,150),t.urlParams=window.location.search.substr(1),t.maxTries=1,t.readyInterval=null,t.magURL=t.protocol+"//d3ezl4ajpp2zy8.cloudfront.net",t.pixelURL=t.protocol+"//wikia-arts.t.domdex.com/search.js",t.pixelFired=!1,t.queryStringObject=r.getQueryStringObject(),t.pathnameArray=r.getPathnameArray(),t.excludedTerms={search:!0},t.templates=[{id:525,keyword:"search",name:"Result Page",pairings:{},url:"wikia.com"}],t.pixels_map=null,t.conversion_pixels="conversion_pixels"in _mag?_mag.conversion_pixels:[],t.retargeting_pixels="retargeting_pixels"in _mag?_mag.retargeting_pixels:[],r.log(t)},getReferrerUrl:function(){var e=document.referrer;return(void 0==e||""==e)&&(e=_mag.refUrl),void 0==e&&(e=""),e.length>147&&(e=e.substr(0,147)+"..."),r.log("Smag.getReferrerUrl: Referrer url "+e),e},searchReady:function(){if(r.log("Smag.searchReady - interval: "+t.intervals),!t.pixelFired){var e=t.bestTemplateResults.keyword;return e?r.stopSearch(e,"Smag.searchReady: found page kws: "+e+" -- clear ing interval"):(t.intervals--,t.intervals<=0&&r.stopSearch(null,"Smag.searchReady - page kws not found - forcing track without")),!0}},stopSearch:function(e,n){e&&(t.bestTemplateResults.ns=r.decodeKeywords(e)),r.log(n),r.trackQuery(),window.clearInterval(t.readyInterval)},escapeRegExp:function(e){return e.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1")},getPublicHost:function(){var e=window.location.hostname.split("."),t=e.length;return 3==t&&"uk"!=e[t-1]&&e.shift(),r.log("Smag.getPublicHost: Public host is "+e.join(".")),e.join(".")},getQueryStringObject:function(){for(var e=window.location.search.substring(1),t=e.split("&"),r={},n=0;n<t.length;n++){var i=t[n].split("=");r[i[0]]=i[1]}return r},getPathnameArray:function(){for(var e=window.location.pathname.split("/"),t=[],r=0;r<e.length;r++)e[r].trim().length&&t.push(decodeURIComponent(e[r].trim()));return t},trackQuery:function(){r.log("trackingQuery");var e=t.publisherKeywords;t.keywordSource="pub",null==e&&(e=t.defaultKeywords,t.keywordSource="defkwd"),t.bestTemplateResults.ns&&(e=t.bestTemplateResults.ns,t.keywordSource="page");var i=r.buildSearchTrackingUrl(e);document.body.appendChild(n.buildScript(i)),t.pixelFired=!0,r.log(i)},log:function(e){t.debugMode&&console.log(e)},buildSearchTrackingUrl:function(e){var n=r.decodeKeywords(e),i={k:n,ks:t.keywordSource,pk:t.publisherKeywords,s:"1",t1:t.startTime,t2:t.executeTime,t3:(new Date).getTime(),v:t.tagVersion,u:t.currentURL,r:t.refURL,ifr:t.isIFrame,tit:t.title};for(var a in t.bestTemplateResults)i[a]=t.bestTemplateResults[a];return r.log("Smag.buildSearchTrackingUrl: Search params are "+r.encodeQueryData(i)),t.pixelURL+"?"+r.encodeQueryData(i)},decodeKeywords:function(e){var t=e.replace(/\+/g," ").replace(/&/g," and ").replace(/\|/g," or ").replace(/\(|\)|\'| +(?= )/g,"").replace(/ AND | OR /g," ").replace(/"/g,"");return decodeURIComponent(t)},encodeQueryData:function(e){var t=[];for(var r in e){var n=e[r]?encodeURIComponent(e[r]):"";t.push(encodeURIComponent(r)+"="+n)}return t.join("&")}},n={init:function(e){"undefined"!=typeof e.pixels_map&&null!=e.pixels_map&&("undefined"!=typeof e.pixels_map.conversion&&null!=e.pixels_map.conversion&&e.pixels_map.conversion!=[]&&n.firePixels(e.pixels_map.conversion,e.conversion_pixels,"conversion"),"undefined"!=typeof e.pixels_map.retargeting&&null!=e.pixels_map.retargeting&&e.pixels_map.retargeting!=[]&&n.firePixels(e.pixels_map.retargeting,e.retargeting_pixels,"retargeting"))},firePixels:function(e,t){if(e.length>0&&t.length>0){var r=null;for(var i in e)~t.indexOf(e[i].pixel_id)&&(r=n.buildPixel(e[i]),null!=r&&document.body.appendChild(r))}},buildPixel:function(e){var t=null;return e.pixel_js_url?t=n.buildScript(e.pixel_js_url):e.pixel_img_url&&(t=n.buildImage(e.pixel_img_url)),t},buildScript:function(e){var t=document.createElement("script");return t.type="text/javascript",t.src=e,t},buildImage:function(e){var t=document.createElement("img");return t.src=e,t.style="display: none;",t.height=1,t.width=1,t},detectUrl:function(e){var n=t.currentURL;return n=n.split("#")[0],target_url_regex=new RegExp("^https?:\\/\\/"+e,"gi"),r.log("Smag.detectUrl: Current Url: "+n),n.match(target_url_regex)?!0:!1},detectDomain:function(e){var n=t.publicHost,i=new RegExp(e,"gi");return r.log("Smag.detectDomain: Current Domain: "+n),n.match(i)?!0:!1}},i={init:function(e){if("undefined"!=typeof e&&null!=e&&e.length>0){for(var t,r,a=null,o=0,l=0;l<e.length;l++){var s=e[l];if(n.detectDomain(s.url)){t=i.parsePairings(s);var u=i.countSuccessfulPairings(t);u>=o&&(o=u,a=s)}}return a&&(r=i.parseDOMWithTemplate(a),r.ns=i.parseKeyword(a.keyword),r.tid=a.id),r}},parseKeyword:function(e){return i.isNumeric(e)?t.pathnameArray[parseInt(e,10)]:t.queryStringObject[e]},parsePairings:function(e){var t={};for(var r in e.pairings)t[r]=i.getElementByXPath(e.pairings[r]);return t},parseBreadcrumb:function(e){var t=/(\w+.?[>\|/].?)+\w+/g,r=/(\||>|\.)/g;if(e.match(t)){var n=e.match(r),a=n.length>0?n[0]:void 0;if("undefined"!=typeof a){for(var o=e.split(a),l=0;l<o.length;l++)o[l]=i.collapseWhiteSpace(o[l]);return o}}},countSuccessfulPairings:function(e){var t=0;for(var r in e)null!==e[r]&&"undefined"!=typeof e[r]&&t++;return t},parseDOMWithTemplate:function(e){var t={};for(var r in e.pairings)switch(r){case"bc":t[r]=i.parseBreadcrumb(e.pairings[r]);break;default:t[r]=i.getTextByXPath(e.pairings[r])}return t},getElementByXPath:function(e){return document.evaluate(e,document,null,9,null).singleNodeValue},isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},getText:function(e){var t,r="",n=0,a=e.nodeType;if(a){if(1===a||9===a||11===a){if("string"==typeof e.textContent)return e.textContent;for(e=e.firstChild;e;e=e.nextSibling)r+=i.getText(e)}else if(3===a||4===a)return e.nodeValue}else for(;t=e[n++];)r+=i.getText(t);return r},collapseWhiteSpace:function(e){return e=e.replace(/\s+/g," "),e.replace(/^\s+|\s+$/g,"")},getTextByXPath:function(e){var t=i.getElementByXPath(e);if(null!==t)return i.collapseWhiteSpace(i.getText(t))}};e()}();